<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/dating/data/MatchRepository.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/dating/data/MatchRepository.kt" />
              <option name="updatedContent" value="package com.example.dating.data&#10;&#10;import com.google.firebase.Timestamp&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import kotlinx.coroutines.tasks.await&#10;&#10;class MatchRepository {&#10;    private val db = FirebaseFirestore.getInstance()&#10;&#10;    suspend fun saveMatch(userId1: String, userId2: String, status: Boolean) {&#10;        // Ensure userId1 &lt; userId2 alphabetically&#10;        val (firstId, secondId) = if (userId1 &lt; userId2) userId1 to userId2 else userId2 to userId1&#10;        val matchData = hashMapOf(&#10;            &quot;userId1&quot; to firstId,&#10;            &quot;userId2&quot; to secondId,&#10;            &quot;timestamp&quot; to Timestamp.now(),&#10;            &quot;status&quot; to status&#10;        )&#10;        // Check for duplicate (userId1/userId2 only)&#10;        val query = db.collection(&quot;match&quot;)&#10;            .whereEqualTo(&quot;userId1&quot;, firstId)&#10;            .whereEqualTo(&quot;userId2&quot;, secondId)&#10;            .get().await()&#10;        android.util.Log.d(&quot;MatchRepository&quot;, &quot;MatchQuery: userId1=$firstId, userId2=$secondId, resultCount=${query.size()}&quot;)&#10;        if (query.isEmpty) {&#10;            db.collection(&quot;match&quot;).add(matchData)&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/dating/data/model/UserFilterPreferences.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/dating/data/model/UserFilterPreferences.kt" />
              <option name="updatedContent" value="package com.example.dating.data.model&#10;&#10;// Represents a user's filter preferences for recommendations&#10;data class UserFilterPreferences(&#10;    val preferredGender: String? = null,&#10;    val minAge: Int? = null,&#10;    val maxAge: Int? = null,&#10;    val maxDistance: Int? = null&#10;)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/dating/data/model/repository/UserRepositoryImpl.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/dating/data/model/repository/UserRepositoryImpl.kt" />
              <option name="originalContent" value="package com.example.dating.data.model.repository&#10;&#10;import com.example.dating.data.model.Resource&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import kotlinx.coroutines.tasks.await&#10;import javax.inject.Inject&#10;import com.example.dating.data.model.User&#10;&#10;class UserRepositoryImpl @Inject constructor(&#10;    private val firestore: FirebaseFirestore&#10;) : UserRepository {&#10;&#10;    fun getUser(uid: String): Flow&lt;User?&gt; = callbackFlow {&#10;        val docRef = firestore.collection(&quot;users&quot;).document(uid)&#10;        val listener = docRef.addSnapshotListener { snapshot, _ -&gt;&#10;            offer(snapshot?.toObject(User::class.java))&#10;        }&#10;        awaitClose { listener.remove() }&#10;    }&#10;&#10;    override suspend fun updateUser(user: User) {&#10;        firestore.collection(&quot;users&quot;).document(user.uid).set(user).await()&#10;    }&#10;&#10;    override suspend fun saveProfile(&#10;        userId: String,&#10;        firstName: String,&#10;        lastName: String,&#10;        birthday: String?,&#10;        imageUrl: String?&#10;    ): Resource&lt;Unit&gt; {&#10;        return try {&#10;            val userMap = hashMapOf(&#10;                &quot;firstName&quot; to firstName,&#10;                &quot;lastName&quot; to lastName,&#10;                &quot;birthday&quot; to birthday,&#10;                &quot;imageUrl&quot; to imageUrl&#10;            )&#10;            firestore.collection(&quot;users&quot;).document(userId)&#10;                .set(userMap)&#10;                .await()&#10;            Resource.Success(Unit)&#10;        } catch (e: Exception) {&#10;            Resource.Failure(e)&#10;        }&#10;    }&#10;&#10;    override suspend fun updateGender(userId: String, gender: String): Resource&lt;Unit&gt; {&#10;        return try {&#10;            firestore.collection(&quot;users&quot;).document(userId)&#10;                .update(&quot;gender&quot;, gender)&#10;                .await()&#10;            Resource.Success(Unit)&#10;        } catch (e: Exception) {&#10;            Resource.Failure(e)&#10;        }&#10;    }&#10;&#10;    override suspend fun updateInterests(userId: String, interests: List&lt;String&gt;): Resource&lt;Unit&gt; {&#10;        return try {&#10;            firestore.collection(&quot;users&quot;).document(userId)&#10;                .update(&quot;interests&quot;, interests)&#10;                .await()&#10;            Resource.Success(Unit)&#10;        } catch (e: Exception) {&#10;            Resource.Failure(e)&#10;        }&#10;    }&#10;&#10;    override suspend fun updateJobLocationDescription(&#10;        userId: String,&#10;        job: String?,&#10;        location: String?,&#10;        description: String?&#10;    ): Resource&lt;Unit&gt; {&#10;        return try {&#10;            firestore.collection(&quot;users&quot;).document(userId)&#10;                .update(mapOf(&#10;                    &quot;job&quot; to job,&#10;                    &quot;location&quot; to location,&#10;                    &quot;description&quot; to description&#10;                ))&#10;                .await()&#10;            Resource.Success(Unit)&#10;        } catch (e: Exception) {&#10;            Resource.Failure(e)&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.dating.data.model.repository&#10;&#10;import com.example.dating.data.model.Resource&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import kotlinx.coroutines.flow.Flow&#10;import kotlinx.coroutines.flow.callbackFlow&#10;import kotlinx.coroutines.tasks.await&#10;import javax.inject.Inject&#10;import com.example.dating.data.model.User&#10;&#10;class UserRepositoryImpl @Inject constructor(&#10;    private val firestore: FirebaseFirestore&#10;) : UserRepository {&#10;&#10;    override fun getUser(uid: String): Flow&lt;User?&gt; = callbackFlow {&#10;        val docRef = firestore.collection(&quot;users&quot;).document(uid)&#10;        val listener = docRef.addSnapshotListener { snapshot, _ -&gt;&#10;            trySend(snapshot?.toObject(User::class.java))&#10;        }&#10;        awaitClose { listener.remove() }&#10;    }&#10;&#10;    override suspend fun updateUser(user: User) {&#10;        firestore.collection(&quot;users&quot;).document(user.uid).set(user).await()&#10;    }&#10;&#10;    override suspend fun saveProfile(&#10;        user: User&#10;    ) {&#10;        firestore.collection(&quot;users&quot;).document(user.uid).set(user).await()&#10;    }&#10;&#10;    override suspend fun updateGender(uid: String, gender: String) {&#10;        firestore.collection(&quot;users&quot;).document(uid).update(&quot;gender&quot;, gender).await()&#10;    }&#10;&#10;    override suspend fun updateInterests(uid: String, interests: List&lt;String&gt;) {&#10;        firestore.collection(&quot;users&quot;).document(uid).update(&quot;interests&quot;, interests).await()&#10;    }&#10;&#10;    override suspend fun updateJobLocationDescription(uid: String, job: String?, location: String?, description: String?) {&#10;        firestore.collection(&quot;users&quot;).document(uid).update(&#10;            mapOf(&#10;                &quot;job&quot; to job,&#10;                &quot;location&quot; to location,&#10;                &quot;description&quot; to description&#10;            )&#10;        ).await()&#10;    }&#10;&#10;    override suspend fun uploadAvatar(uid: String, uri: android.net.Uri): String {&#10;        // TODO: Implement Firebase Storage upload and return the URL&#10;        return &quot;&quot;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/dating/ui/components/FilterDialog.kt.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/dating/ui/components/FilterDialog.kt.kt" />
              <option name="originalContent" value="package com.example.dating.ui.components&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.ArrowForward&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.navigation.NavController&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun FilterScreen(navController: NavController) {&#10;    // State variables&#10;    var selectedInterest by remember { mutableStateOf(&quot;Girls&quot;) }&#10;    var location by remember { mutableStateOf(&quot;Chicago, USA&quot;) }&#10;    var distance by remember { mutableFloatStateOf(40f) }&#10;    var ageRange by remember { mutableStateOf(20f..28f) }&#10;&#10;    // Bottom sheet or dialog content&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .wrapContentHeight()&#10;            .clip(RoundedCornerShape(topStart = 24.dp, topEnd = 24.dp))&#10;            .background(Color.White)&#10;            .padding(16.dp),&#10;        horizontalAlignment = Alignment.CenterHorizontally&#10;    ) {&#10;        // Notch&#10;        Box(&#10;            modifier = Modifier&#10;                .width(40.dp)&#10;                .height(4.dp)&#10;                .background(Color.Gray.copy(alpha = 0.5f), CircleShape)&#10;                .align(Alignment.CenterHorizontally)&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;&#10;        // Title and Clear&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.SpaceBetween,&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Text(&#10;                text = &quot;Filters&quot;,&#10;                fontSize = 20.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.Black&#10;            )&#10;            TextButton(onClick = { /* TODO: Clear filters */ }) {&#10;                Text(&#10;                    text = &quot;Clear&quot;,&#10;                    color = Color(0xFFFF69B4), // Pink&#10;                    fontSize = 16.sp&#10;                )&#10;            }&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        // Interested in&#10;        Text(&#10;            text = &quot;Interested in&quot;,&#10;            fontSize = 16.sp,&#10;            color = Color.Gray,&#10;            modifier = Modifier.align(Alignment.Start)&#10;        )&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        SegmentedButtonRow(modifier = Modifier.fillMaxWidth()) {&#10;            SegmentedButton(&#10;                selected = selectedInterest == &quot;Girls&quot;,&#10;                onClick = { selectedInterest = &quot;Girls&quot; },&#10;                shape = RoundedCornerShape(topStart = 8.dp, bottomStart = 8.dp)&#10;            ) {&#10;                Text(&quot;Girls&quot;)&#10;            }&#10;            SegmentedButton(&#10;                selected = selectedInterest == &quot;Boys&quot;,&#10;                onClick = { selectedInterest = &quot;Boys&quot; },&#10;                shape = RoundedCornerShape(0.dp)&#10;            ) {&#10;                Text(&quot;Boys&quot;)&#10;            }&#10;            SegmentedButton(&#10;                selected = selectedInterest == &quot;Both&quot;,&#10;                onClick = { selectedInterest = &quot;Both&quot; },&#10;                shape = RoundedCornerShape(topEnd = 8.dp, bottomEnd = 8.dp)&#10;            ) {&#10;                Text(&quot;Both&quot;)&#10;            }&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        // Location&#10;        Text(&#10;            text = &quot;Location&quot;,&#10;            fontSize = 16.sp,&#10;            color = Color.Gray,&#10;            modifier = Modifier.align(Alignment.Start)&#10;        )&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        OutlinedTextField(&#10;            value = location,&#10;            onValueChange = { /* Read-only, tap to select */ },&#10;            readOnly = true,&#10;            modifier = Modifier.fillMaxWidth(),&#10;            trailingIcon = {&#10;                Icon(&#10;                    imageVector = Icons.Default.ArrowForward,&#10;                    contentDescription = &quot;Select location&quot;,&#10;                    tint = Color(0xFFFF0000) // Red&#10;                )&#10;            },&#10;            singleLine = true,&#10;            interactionSource = remember { MutableInteractionSource() }.also { interactionSource -&gt;&#10;                // TODO: Handle click to open location selector&#10;            }&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        // Distance&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.SpaceBetween&#10;        ) {&#10;            Text(&#10;                text = &quot;Distance&quot;,&#10;                fontSize = 16.sp,&#10;                color = Color.Gray&#10;            )&#10;            Text(&#10;                text = &quot;${distance.toInt()}km&quot;,&#10;                fontSize = 16.sp,&#10;                color = Color.Gray&#10;            )&#10;        }&#10;        Slider(&#10;            value = distance,&#10;            onValueChange = { distance = it },&#10;            valueRange = 0f..100f, // Assuming max 100km&#10;            modifier = Modifier.fillMaxWidth(),&#10;            colors = SliderDefaults.colors(&#10;                thumbColor = Color(0xFFBB86FC), // Purple&#10;                activeTrackColor = Color(0xFFBB86FC),&#10;                inactiveTrackColor = Color.LightGray&#10;            )&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        // Age&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.SpaceBetween&#10;        ) {&#10;            Text(&#10;                text = &quot;Age&quot;,&#10;                fontSize = 16.sp,&#10;                color = Color.Gray&#10;            )&#10;            Text(&#10;                text = &quot;${ageRange.start.toInt()}-${ageRange.endInclusive.toInt()}&quot;,&#10;                fontSize = 16.sp,&#10;                color = Color.Gray&#10;            )&#10;        }&#10;        RangeSlider(&#10;            value = ageRange,&#10;            onValueChange = { ageRange = it },&#10;            valueRange = 18f..100f, // Assuming age range&#10;            modifier = Modifier.fillMaxWidth(),&#10;            colors = SliderDefaults.colors(&#10;                thumbColor = Color(0xFFBB86FC), // Purple&#10;                activeTrackColor = Color(0xFFBB86FC),&#10;                inactiveTrackColor = Color.LightGray&#10;            )&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(32.dp))&#10;&#10;        // Continue button&#10;        Button(&#10;            onClick = { /* TODO: Apply filters and navigate */ },&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(48.dp),&#10;            colors = ButtonDefaults.buttonColors(containerColor = Color(0xFFBB86FC).copy(alpha = 0.2f)), // Light purple&#10;            shape = RoundedCornerShape(24.dp)&#10;        ) {&#10;            Text(&#10;                text = &quot;Continue&quot;,&#10;                color = Color.Black,&#10;                fontSize = 16.sp,&#10;                fontWeight = FontWeight.Bold&#10;            )&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.dating.ui.components&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.ArrowForward&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.navigation.NavController&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun FilterDialog(&#10;    show: Boolean,&#10;    onDismiss: () -&gt; Unit,&#10;    onApply: (selectedInterest: String, location: String, distance: Float, ageRange: ClosedFloatingPointRange&lt;Float&gt;) -&gt; Unit&#10;) {&#10;    if (!show) return&#10;    var selectedInterest by remember { mutableStateOf(&quot;Girls&quot;) }&#10;    var location by remember { mutableStateOf(&quot;Chicago, USA&quot;) }&#10;    var distance by remember { mutableStateOf(40f) }&#10;    var ageRange by remember { mutableStateOf(20f..28f) }&#10;&#10;    AlertDialog(&#10;        onDismissRequest = onDismiss,&#10;        confirmButton = {&#10;            Button(&#10;                onClick = {&#10;                    onApply(selectedInterest, location, distance, ageRange)&#10;                    onDismiss()&#10;                },&#10;                modifier = Modifier.fillMaxWidth().height(48.dp),&#10;                colors = ButtonDefaults.buttonColors(containerColor = Color(0xFFBB86FC).copy(alpha = 0.2f)),&#10;                shape = RoundedCornerShape(24.dp)&#10;            ) {&#10;                Text(&quot;Continue&quot;, color = Color.Black, fontSize = 16.sp, fontWeight = FontWeight.Bold)&#10;            }&#10;        },&#10;        dismissButton = {&#10;            TextButton(onClick = onDismiss) {&#10;                Text(&quot;Cancel&quot;, color = Color.Gray)&#10;            }&#10;        },&#10;        title = {&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Text(&quot;Filters&quot;, fontSize = 20.sp, fontWeight = FontWeight.Bold, color = Color.Black)&#10;                TextButton(onClick = {&#10;                    selectedInterest = &quot;Girls&quot;&#10;                    location = &quot;Chicago, USA&quot;&#10;                    distance = 40f&#10;                    ageRange = 20f..28f&#10;                }) {&#10;                    Text(&quot;Clear&quot;, color = Color(0xFFFF69B4), fontSize = 16.sp)&#10;                }&#10;            }&#10;        },&#10;        text = {&#10;            Column(modifier = Modifier.fillMaxWidth(), horizontalAlignment = Alignment.CenterHorizontally) {&#10;                // Interested in&#10;                Text(&quot;Interested in&quot;, fontSize = 16.sp, color = Color.Gray, modifier = Modifier.align(Alignment.Start))&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;                Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.Center) {&#10;                    FilterSegmentButton(&quot;Girls&quot;, selectedInterest == &quot;Girls&quot;) { selectedInterest = &quot;Girls&quot; }&#10;                    FilterSegmentButton(&quot;Boys&quot;, selectedInterest == &quot;Boys&quot;) { selectedInterest = &quot;Boys&quot; }&#10;                    FilterSegmentButton(&quot;Both&quot;, selectedInterest == &quot;Both&quot;) { selectedInterest = &quot;Both&quot; }&#10;                }&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;                // Location&#10;                Text(&quot;Location&quot;, fontSize = 16.sp, color = Color.Gray, modifier = Modifier.align(Alignment.Start))&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;                OutlinedTextField(&#10;                    value = location,&#10;                    onValueChange = { location = it },&#10;                    readOnly = false,&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    trailingIcon = {&#10;                        Icon(imageVector = Icons.Default.ArrowForward, contentDescription = &quot;Select location&quot;, tint = Color(0xFFFF0000))&#10;                    },&#10;                    singleLine = true&#10;                )&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;                // Distance&#10;                Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {&#10;                    Text(&quot;Distance&quot;, fontSize = 16.sp, color = Color.Gray)&#10;                    Text(&quot;${distance.toInt()}km&quot;, fontSize = 16.sp, color = Color.Gray)&#10;                }&#10;                Slider(&#10;                    value = distance,&#10;                    onValueChange = { distance = it },&#10;                    valueRange = 0f..100f,&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = SliderDefaults.colors(&#10;                        thumbColor = Color(0xFFBB86FC),&#10;                        activeTrackColor = Color(0xFFBB86FC),&#10;                        inactiveTrackColor = Color.LightGray&#10;                    )&#10;                )&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;                // Age&#10;                Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {&#10;                    Text(&quot;Age&quot;, fontSize = 16.sp, color = Color.Gray)&#10;                    Text(&quot;${ageRange.start.toInt()}-${ageRange.endInclusive.toInt()}&quot;, fontSize = 16.sp, color = Color.Gray)&#10;                }&#10;                RangeSlider(&#10;                    value = ageRange,&#10;                    onValueChange = { ageRange = it },&#10;                    valueRange = 18f..100f,&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = SliderDefaults.colors(&#10;                        thumbColor = Color(0xFFBB86FC),&#10;                        activeTrackColor = Color(0xFFBB86FC),&#10;                        inactiveTrackColor = Color.LightGray&#10;                    )&#10;                )&#10;            }&#10;        },&#10;        shape = RoundedCornerShape(24.dp),&#10;        containerColor = Color.White&#10;    )&#10;}&#10;&#10;@Composable&#10;private fun FilterSegmentButton(text: String, selected: Boolean, onClick: () -&gt; Unit) {&#10;    Button(&#10;        onClick = onClick,&#10;        colors = ButtonDefaults.buttonColors(&#10;            containerColor = if (selected) Color(0xFFBB86FC) else Color.LightGray,&#10;            contentColor = if (selected) Color.White else Color.Black&#10;        ),&#10;        modifier = Modifier&#10;            .weight(1f)&#10;            .height(36.dp)&#10;            .padding(horizontal = 2.dp),&#10;        shape = RoundedCornerShape(8.dp)&#10;    ) {&#10;        Text(text)&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/dating/ui/components/ProfileCard.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/dating/ui/components/ProfileCard.kt" />
              <option name="originalContent" value="package com.example.dating.ui.components&#10;&#10;import androidx.compose.foundation.BorderStroke&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.snapshots.SnapshotStateList&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.unit.dp&#10;import com.example.dating.data.model.Interest&#10;import com.example.dating.ui.theme.AppColors&#10;&#10;@Composable&#10;fun ProfileCard(&#10;    isEditMode: Boolean,&#10;    onEditToggle: () -&gt; Unit,&#10;    isSaving: Boolean,&#10;    saveError: String?,&#10;    editableFirstName: String,&#10;    editableLastName: String,&#10;    editableBirthday: String,&#10;    editableGender: String,&#10;    editableJob: String,&#10;    editableLocation: String,&#10;    editableDescription: String,&#10;    selectedInterests: SnapshotStateList&lt;String&gt;,&#10;    allInterests: List&lt;Interest&gt;,&#10;    onFirstNameChange: (String) -&gt; Unit,&#10;    onLastNameChange: (String) -&gt; Unit,&#10;    onBirthdayClick: () -&gt; Unit,&#10;    onGenderChange: (String) -&gt; Unit,&#10;    onJobChange: (String) -&gt; Unit,&#10;    onLocationChange: (String) -&gt; Unit,&#10;    onDescriptionChange: (String) -&gt; Unit,&#10;    isEditModeChange: (Boolean) -&gt; Unit&#10;) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp, vertical = 16.dp),&#10;        shape = MaterialTheme.shapes.large,&#10;        elevation = CardDefaults.cardElevation(8.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(20.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.End,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                TextButton(onClick = onEditToggle) {&#10;                    Text(&#10;                        text = if (isEditMode) &quot;Done&quot; else &quot;Edit&quot;,&#10;                        color = AppColors.Text_Pink,&#10;                        fontWeight = androidx.compose.ui.text.font.FontWeight.Bold&#10;                    )&#10;                }&#10;            }&#10;            if (isSaving) {&#10;                CircularProgressIndicator(modifier = Modifier.padding(vertical = 8.dp))&#10;            }&#10;            if (saveError != null) {&#10;                Text(&#10;                    text = saveError,&#10;                    color = androidx.compose.ui.graphics.Color.Red,&#10;                    modifier = Modifier.padding(vertical = 8.dp)&#10;                )&#10;            }&#10;            NameFields(&#10;                firstName = editableFirstName,&#10;                lastName = editableLastName,&#10;                isEditMode = isEditMode,&#10;                onFirstNameChange = onFirstNameChange,&#10;                onLastNameChange = onLastNameChange&#10;            )&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;            BirthdayGenderFields(&#10;                birthday = editableBirthday,&#10;                gender = editableGender,&#10;                isEditMode = isEditMode,&#10;                showCalendar = false,&#10;                onShowCalendar = onBirthdayClick,&#10;                onGenderChange = onGenderChange&#10;            )&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;            JobDropdown(&#10;                job = editableJob,&#10;                isEditMode = isEditMode,&#10;                onJobChange = onJobChange&#10;            )&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;            LocationField(&#10;                location = editableLocation,&#10;                isEditMode = isEditMode,&#10;                onLocationChange = onLocationChange&#10;            )&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;            DescriptionField(&#10;                description = editableDescription,&#10;                isEditMode = isEditMode,&#10;                onDescriptionChange = onDescriptionChange&#10;            )&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;            Text(&#10;                text = &quot;Interests&quot;,&#10;                fontSize = androidx.compose.ui.unit.sp(20),&#10;                color = AppColors.Text_Pink,&#10;                fontWeight = androidx.compose.ui.text.font.FontWeight.Bold,&#10;                modifier = Modifier&#10;                    .padding(bottom = 8.dp)&#10;                    .fillMaxWidth(),&#10;                textAlign = androidx.compose.ui.text.style.TextAlign.Center&#10;            )&#10;            InterestsSection(&#10;                allInterests = allInterests,&#10;                selectedInterests = selectedInterests,&#10;                isEditMode = isEditMode&#10;            )&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.dating.ui.components&#10;&#10;import androidx.compose.foundation.BorderStroke&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.snapshots.SnapshotStateList&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.unit.dp&#10;import com.example.dating.data.model.Interest&#10;import com.example.dating.ui.theme.AppColors&#10;&#10;// Add missing imports for field components&#10;import com.example.dating.ui.components.NameFields&#10;import com.example.dating.ui.components.BirthdayGenderFields&#10;import com.example.dating.ui.components.JobDropdown&#10;import com.example.dating.ui.components.LocationField&#10;import com.example.dating.ui.components.DescriptionField&#10;import com.example.dating.ui.components.InterestsSection&#10;&#10;@Composable&#10;fun ProfileCard(&#10;    isEditMode: Boolean,&#10;    onEditToggle: () -&gt; Unit,&#10;    isSaving: Boolean,&#10;    saveError: String?,&#10;    editableFirstName: String,&#10;    editableLastName: String,&#10;    editableBirthday: String,&#10;    editableGender: String,&#10;    editableJob: String,&#10;    editableLocation: String,&#10;    editableDescription: String,&#10;    selectedInterests: SnapshotStateList&lt;String&gt;,&#10;    allInterests: List&lt;Interest&gt;,&#10;    onFirstNameChange: (String) -&gt; Unit,&#10;    onLastNameChange: (String) -&gt; Unit,&#10;    onBirthdayClick: () -&gt; Unit,&#10;    onGenderChange: (String) -&gt; Unit,&#10;    onJobChange: (String) -&gt; Unit,&#10;    onLocationChange: (String) -&gt; Unit,&#10;    onDescriptionChange: (String) -&gt; Unit,&#10;    isEditModeChange: (Boolean) -&gt; Unit&#10;) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp, vertical = 16.dp),&#10;        shape = MaterialTheme.shapes.large,&#10;        elevation = CardDefaults.cardElevation(8.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(20.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.End,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                TextButton(onClick = onEditToggle) {&#10;                    Text(&#10;                        text = if (isEditMode) &quot;Done&quot; else &quot;Edit&quot;,&#10;                        color = AppColors.Text_Pink,&#10;                        fontWeight = androidx.compose.ui.text.font.FontWeight.Bold&#10;                    )&#10;                }&#10;            }&#10;            if (isSaving) {&#10;                CircularProgressIndicator(modifier = Modifier.padding(vertical = 8.dp))&#10;            }&#10;            if (saveError != null) {&#10;                Text(&#10;                    text = saveError,&#10;                    color = androidx.compose.ui.graphics.Color.Red,&#10;                    modifier = Modifier.padding(vertical = 8.dp)&#10;                )&#10;            }&#10;            NameFields(&#10;                firstName = editableFirstName,&#10;                lastName = editableLastName,&#10;                isEditMode = isEditMode,&#10;                onFirstNameChange = onFirstNameChange,&#10;                onLastNameChange = onLastNameChange&#10;            )&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;            BirthdayGenderFields(&#10;                birthday = editableBirthday,&#10;                gender = editableGender,&#10;                isEditMode = isEditMode,&#10;                showCalendar = false,&#10;                onShowCalendar = onBirthdayClick,&#10;                onGenderChange = onGenderChange&#10;            )&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;            JobDropdown(&#10;                job = editableJob,&#10;                isEditMode = isEditMode,&#10;                onJobChange = onJobChange&#10;            )&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;            LocationField(&#10;                location = editableLocation,&#10;                isEditMode = isEditMode,&#10;                onLocationChange = onLocationChange&#10;            )&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;            DescriptionField(&#10;                description = editableDescription,&#10;                isEditMode = isEditMode,&#10;                onDescriptionChange = onDescriptionChange&#10;            )&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;            Text(&#10;                text = &quot;Interests&quot;,&#10;                fontSize = androidx.compose.ui.unit.sp(20),&#10;                color = AppColors.Text_Pink,&#10;                fontWeight = androidx.compose.ui.text.font.FontWeight.Bold,&#10;                modifier = Modifier&#10;                    .padding(bottom = 8.dp)&#10;                    .fillMaxWidth(),&#10;                textAlign = androidx.compose.ui.text.style.TextAlign.Center&#10;            )&#10;            InterestsSection(&#10;                allInterests = allInterests,&#10;                selectedInterests = selectedInterests,&#10;                isEditMode = isEditMode&#10;            )&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/dating/ui/mainscreens/HomeScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/dating/ui/mainscreens/HomeScreen.kt" />
              <option name="originalContent" value="package com.example.dating.ui.mainscreens&#10;&#10;import android.util.Log&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.gestures.detectDragGestures&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.IconButton&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.runtime.saveable.rememberSaveable&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.draw.shadow&#10;import androidx.compose.ui.graphics.Brush&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.input.pointer.pointerInput&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.Dp&#10;import androidx.compose.ui.unit.IntOffset&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.navigation.NavController&#10;import kotlinx.coroutines.launch&#10;import androidx.compose.animation.core.Animatable&#10;import androidx.compose.animation.core.tween&#10;import androidx.compose.material3.CircularProgressIndicator&#10;import com.example.dating.ui.theme.AppColors&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import java.util.Calendar&#10;import androidx.compose.runtime.MutableState&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;import androidx.compose.ui.draw.rotate&#10;import androidx.compose.ui.util.lerp&#10;import androidx.compose.animation.core.Spring&#10;import androidx.compose.animation.core.spring&#10;import androidx.compose.material3.Scaffold&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import com.example.dating.viewmodel.HomeViewModel&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.hilt.navigation.compose.hiltViewModel&#10;import com.example.dating.data.model.Resource&#10;import com.example.dating.data.model.User&#10;import com.example.dating.ui.components.BottomNavigationBar&#10;import androidx.compose.foundation.gestures.detectTapGestures&#10;import com.example.dating.navigation.Screen&#10;import coil.compose.rememberAsyncImagePainter&#10;import com.example.dating.viewmodel.ProfileViewModel&#10;&#10;@Composable&#10;fun HomeScreen(&#10;    navController: NavController,&#10;    homeViewModel: HomeViewModel = hiltViewModel()&#10;) {&#10;    val usersResource by homeViewModel.usersState.collectAsState()&#10;    val profileIndex by homeViewModel.profileIndex.collectAsState()&#10;    Log.d(&quot;HomeScreen&quot;, &quot;usersResource: $usersResource&quot;)&#10;    Log.d(&quot;HomeScreen&quot;, &quot;profileIndex: $profileIndex&quot;)&#10;&#10;&#10;&#10;    // Helper functions&#10;    fun handleProfileAction(isLike: Boolean, profiles: List&lt;User&gt;, homeViewModel: HomeViewModel, navController: NavController) {&#10;        val currentProfile = profiles.getOrNull(profileIndex)&#10;        if (currentProfile != null) {&#10;            if (isLike) {&#10;                val likedUserId = currentProfile.uid&#10;                if (likedUserId != null) {&#10;                    homeViewModel.likeProfile(likedUserId)&#10;                    // Check for match and navigate if found&#10;                    val matchId = homeViewModel.matchFoundUserId.value&#10;                    if (matchId != null) {&#10;                        navController.navigate(&quot;match&quot;)&#10;                    }&#10;                }&#10;            }&#10;            homeViewModel.nextProfile()&#10;        }&#10;    }&#10;    suspend fun animateSwipe(offsetX: Animatable&lt;Float, *&gt;, direction: Float) {&#10;        offsetX.animateTo(direction * 400f, tween(300))&#10;        offsetX.snapTo(0f)&#10;    }&#10;&#10;&#10;&#10;    // Observe matchFoundUserId and navigate if a match is found&#10;    val matchFoundUserId by homeViewModel.matchFoundUserId.collectAsState()&#10;    val matchIdHandled = remember { mutableStateOf(false) }&#10;    LaunchedEffect(matchFoundUserId) {&#10;        Log.d(&quot;HomeScreen&quot;, &quot;LaunchedEffect triggered: matchFoundUserId=$matchFoundUserId, matchIdHandled=${matchIdHandled.value}&quot;)&#10;        if (matchFoundUserId != null &amp;&amp; !matchIdHandled.value) {&#10;            Log.d(&quot;HomeScreen&quot;, &quot;Navigating to match/${matchFoundUserId}&quot;)&#10;            matchIdHandled.value = true&#10;            navController.navigate(&quot;match/${matchFoundUserId}&quot;)&#10;            Log.d(&quot;HomeScreen&quot;, &quot;Resetting matchFoundUserId after navigation&quot;)&#10;            homeViewModel.resetMatchFoundUserId()&#10;        }&#10;    }&#10;&#10;    // Use Box to overlay BottomNavigationBar and keep it fixed at the bottom&#10;    Scaffold(&#10;        bottomBar = {&#10;            BottomNavigationBar(navController, 0)&#10;        }&#10;    ) { paddingValues -&gt;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(paddingValues)&#10;                .background(AppColors.MainBackground)&#10;        ) {&#10;            HomeHeader(navController, homeViewModel)&#10;            when (usersResource) {&#10;                is Resource.Loading -&gt; {&#10;                    Box(&#10;                        modifier = Modifier.fillMaxWidth().height(200.dp),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        CircularProgressIndicator()&#10;                    }&#10;                }&#10;&#10;                is Resource.Failure -&gt; {&#10;                    val error =&#10;                        (usersResource as Resource.Failure).exception?.message ?: &quot;Unknown error&quot;&#10;                    Box(&#10;                        modifier = Modifier.fillMaxWidth().height(200.dp),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        Text(&quot;Error: $error&quot;, color = Color.Red)&#10;                    }&#10;                }&#10;&#10;                is Resource.Success -&gt; {&#10;                    val users = (usersResource as Resource.Success&lt;List&lt;User&gt;&gt;).result&#10;                    val currentProfile = users.getOrNull(profileIndex)&#10;                    val nextProfile = users.getOrNull(profileIndex + 1)&#10;                    if (currentProfile == null &amp;&amp; nextProfile == null) {&#10;                        Box(&#10;                            modifier = Modifier&#10;                                .fillMaxWidth()&#10;                                .height(900.dp),&#10;                            contentAlignment = Alignment.Center&#10;                        ) {&#10;                            Text(&quot;No profiles available&quot;, color = Color.Gray)&#10;                        }&#10;                        return@Column&#10;                    }&#10;                    // Create shared offsetX and offsetY&#10;                    val offsetX = remember { Animatable(0f) }&#10;                    val offsetY = remember { Animatable(0f) }&#10;                    Box(modifier = Modifier.weight(1f)) {&#10;                        ProfileCard(&#10;                            profiles = users,&#10;                            profileIndex = profileIndex,&#10;                            handleProfileAction = { isLike, profiles, homeViewModel -&gt;&#10;                                handleProfileAction(&#10;                                    isLike,&#10;                                    profiles,&#10;                                    homeViewModel,&#10;                                    navController&#10;                                )&#10;                            },&#10;                            animateSwipe = { direction -&gt; animateSwipe(offsetX, direction) },&#10;                            offsetX = offsetX,&#10;                            offsetY = offsetY,&#10;                            navController = navController&#10;                        )&#10;                    }&#10;                    ActionButtons(&#10;                        profiles = users,&#10;                        profileIndex = profileIndex,&#10;                        handleProfileAction = { isLike, profiles, homeViewModel -&gt;&#10;                            handleProfileAction(&#10;                                isLike,&#10;                                profiles,&#10;                                homeViewModel,&#10;                                navController&#10;                            )&#10;                        },&#10;                        animateSwipe = { direction -&gt; animateSwipe(offsetX, direction) },&#10;                        offsetX = offsetX,&#10;                        homeViewModel = homeViewModel&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;}&#10;&#10;@Composable&#10;fun HomeHeader(navController: NavController, homeViewModel: HomeViewModel) {&#10;    val showFilterDialog = remember { mutableStateOf(false) }&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(start = 48.dp, end = 48.dp, top = 40.dp, bottom = 30.dp),&#10;        horizontalArrangement = Arrangement.SpaceBetween,&#10;        verticalAlignment = Alignment.CenterVertically&#10;    ) {&#10;        IconButton(onClick = { navController.navigate(&quot;profile_details&quot;) }) {&#10;            Icon(&#10;                imageVector = Icons.Default.Person,&#10;                contentDescription = &quot;Profile&quot;,&#10;                tint = AppColors.Text_Pink&#10;            )&#10;        }&#10;&#10;        Text(&#10;            text = &quot;Discover&quot;,&#10;            color = Color.Black,&#10;            fontWeight = FontWeight.Bold,&#10;            fontSize = 30.sp&#10;        )&#10;&#10;        IconButton(onClick = { showFilterDialog.value = true }) {&#10;            Icon(&#10;                imageVector = Icons.Default.Settings,&#10;                contentDescription = &quot;Filter&quot;,&#10;                tint = AppColors.Text_Pink&#10;            )&#10;        }&#10;    }&#10;    val userViewModel: ProfileViewModel = hiltViewModel()&#10;    val currentUid = userViewModel.getCurrentUserId().orEmpty()&#10;    Log.d(&quot;HomeHeader&quot;, &quot;Current UID: $currentUid&quot;)&#10;    if (showFilterDialog.value) {&#10;        com.example.dating.ui.components.FilterDialog(&#10;            show = showFilterDialog.value,&#10;            onDismiss = { showFilterDialog.value = false },&#10;            userViewModel = userViewModel,&#10;            currentUid = currentUid,&#10;            onApply = { selectedInterest, location, distance, ageRange, filterChanged -&gt;&#10;                if (filterChanged) {&#10;                    homeViewModel.fetchHome()&#10;                }&#10;                showFilterDialog.value = false&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ProfileCard(&#10;    profiles: List&lt;User&gt;,&#10;    profileIndex: Int,&#10;    handleProfileAction: (Boolean, List&lt;User&gt;, HomeViewModel) -&gt; Unit,&#10;    animateSwipe: suspend (Animatable&lt;Float, *&gt;, Float) -&gt; Unit,&#10;    homeViewModel: HomeViewModel = viewModel(),&#10;    navController: NavController&#10;) {&#10;    val currentProfile = profiles.getOrNull(profileIndex)&#10;    val nextProfile = profiles.getOrNull(profileIndex + 1)&#10;    val currentUid = currentProfile?.uid&#10;&#10;    if (currentProfile == null &amp;&amp; nextProfile == null) {&#10;        Box(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(900.dp),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Text(&quot;No profiles available&quot;, color = Color.Gray)&#10;        }&#10;        return&#10;    }&#10;&#10;    val scope = rememberCoroutineScope()&#10;    val offsetX = remember { Animatable(0f) }&#10;    val offsetY = remember { Animatable(0f) }&#10;    val isDragging = remember { mutableStateOf(false) }&#10;    val likeProgress = (offsetX.value / 200f).coerceIn(0f, 1f)&#10;    val dislikeProgress = (-offsetX.value / 200f).coerceIn(0f, 1f)&#10;    val iconAlpha = maxOf(likeProgress, dislikeProgress)&#10;    val iconScale = 1f + 0.3f * iconAlpha&#10;    val cardRotation = (offsetX.value / 15).coerceIn(-25f, 25f)&#10;    val threshold = 200f&#10;&#10;    Box(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .height(550.dp)&#10;            .padding(horizontal = 30.dp),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        // Render next card first (always present if available)&#10;        if (nextProfile != null) {&#10;            ProfileCardContent(&#10;                profile = nextProfile,&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(550.dp)&#10;                    .clip(RoundedCornerShape(32.dp))&#10;                    .background(Color(0xFF23222B))&#10;                    .graphicsLayer(&#10;                        scaleX = lerp(0.95f, 1f, iconAlpha),&#10;                        scaleY = lerp(0.95f, 1f, iconAlpha),&#10;                        alpha = lerp(0.7f, 1f, iconAlpha)&#10;                    ),&#10;                navController = navController&#10;            )&#10;        }&#10;        // Top card (draggable, always present if available)&#10;        if (currentProfile != null) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(550.dp)&#10;                    .offset { IntOffset(offsetX.value.toInt(), offsetY.value.toInt()) }&#10;                    .rotate(cardRotation)&#10;                    .clip(RoundedCornerShape(32.dp))&#10;                    .background(Color(0xFF23222B))&#10;                    .pointerInput(currentUid) {&#10;                        detectTapGestures(&#10;                            onDoubleTap = {&#10;                                currentUid?.let { uid -&gt;&#10;                                    navController.navigate(Screen.UserProfile.route(uid))&#10;                                }&#10;                            }&#10;                        )&#10;                    }&#10;                    .pointerInput(profileIndex) {&#10;                        detectDragGestures(&#10;                            onDragStart = { isDragging.value = true },&#10;                            onDragEnd = {&#10;                                isDragging.value = false&#10;                                scope.launch {&#10;                                    when {&#10;                                        offsetX.value &gt; threshold -&gt; {&#10;                                            animateSwipe(offsetX, 1f)&#10;                                            offsetY.snapTo(0f)&#10;                                            handleProfileAction(true, profiles, homeViewModel)&#10;                                        }&#10;                                        offsetX.value &lt; -threshold -&gt; {&#10;                                            animateSwipe(offsetX, -1f)&#10;                                            offsetY.snapTo(0f)&#10;                                            handleProfileAction(false, profiles, homeViewModel)&#10;&#10;                                        }&#10;                                        else -&gt; {&#10;                                            offsetX.animateTo(0f, spring(stiffness = Spring.StiffnessMedium))&#10;                                            offsetY.animateTo(0f, spring(stiffness = Spring.StiffnessMedium))&#10;                                        }&#10;                                    }&#10;                                }&#10;                            },&#10;                            onDrag = { change, dragAmount -&gt;&#10;                                scope.launch {&#10;                                    offsetX.snapTo(offsetX.value + dragAmount.x)&#10;                                    offsetY.snapTo(offsetY.value + dragAmount.y)&#10;                                }&#10;                            }&#10;                        )&#10;                    },&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                ProfileCardContent(&#10;                    profile = currentProfile,&#10;                    modifier = Modifier.fillMaxSize(),&#10;                    navController = navController,&#10;                    likeProgress = likeProgress,&#10;                    dislikeProgress = dislikeProgress,&#10;                    iconAlpha = iconAlpha,&#10;                    iconScale = iconScale&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun ProfileCardContent(&#10;    profile: User?,&#10;    modifier: Modifier = Modifier,&#10;    navController: NavController,&#10;    likeProgress: Float = 0f,&#10;    dislikeProgress: Float = 0f,&#10;    iconAlpha: Float = 0f,&#10;    iconScale: Float = 1f&#10;) {&#10;    if (profile == null) return&#10;    val firstName = profile.firstName ?: &quot;&quot;&#10;    val lastName = profile.lastName ?: &quot;&quot;&#10;    val name = (firstName + &quot; &quot; + lastName).trim().ifEmpty { &quot;Unknown&quot; }&#10;    val birthday = profile.birthday&#10;    val age = birthday?.let {&#10;        try {&#10;            val year = it.split(&quot;/&quot;).getOrNull(2)?.toInt() ?: throw Exception(&quot;Invalid date&quot;)&#10;            val currentYear = Calendar.getInstance().get(Calendar.YEAR)&#10;            (currentYear - year).toString()&#10;        } catch (e: Exception) {&#10;            &quot;?&quot;&#10;        }&#10;    } ?: &quot;?&quot;&#10;    val description = profile.description ?: &quot;No description&quot;&#10;    val distance = profile.distance?.toString() ?: &quot;1 km&quot;&#10;&#10;    Box(modifier = modifier) {&#10;        if (profile.avatarUrl != null &amp;&amp; profile.avatarUrl.isNotBlank()) {&#10;            Image(&#10;                painter = rememberAsyncImagePainter(model = profile.avatarUrl),&#10;                contentDescription = &quot;Profile Image&quot;,&#10;                contentScale = ContentScale.Crop,&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .clip(RoundedCornerShape(32.dp))&#10;            )&#10;        } else {&#10;            Image(&#10;                imageVector = Icons.Default.Person,&#10;                contentDescription = &quot;Profile Image&quot;,&#10;                contentScale = ContentScale.Crop,&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .clip(RoundedCornerShape(32.dp))&#10;            )&#10;        }&#10;        Box(&#10;            modifier = Modifier&#10;                .padding(16.dp)&#10;                .align(Alignment.TopStart)&#10;                .background(Color.White.copy(alpha = 0.85f), RoundedCornerShape(50))&#10;                .padding(horizontal = 16.dp, vertical = 6.dp)&#10;        ) {&#10;            Text(distance, color = Color.Black, fontWeight = FontWeight.Bold, fontSize = 14.sp)&#10;        }&#10;        Box(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(120.dp)&#10;                .align(Alignment.BottomCenter)&#10;                .background(&#10;                    Brush.verticalGradient(&#10;                        colors = listOf(Color.Transparent, Color.Black),&#10;                        startY = 0f,&#10;                        endY = 300f&#10;                    ),&#10;                    shape = RoundedCornerShape(bottomStart = 32.dp, bottomEnd = 32.dp)&#10;                )&#10;        )&#10;        Column(&#10;            modifier = Modifier&#10;                .align(Alignment.BottomCenter)&#10;                .padding(16.dp),&#10;            verticalArrangement = Arrangement.Center,&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&#10;                text = &quot;$name, $age&quot;,&#10;                color = Color.White,&#10;                fontWeight = FontWeight.Bold,&#10;                fontSize = 28.sp,&#10;                maxLines = 1,&#10;                modifier = Modifier.fillMaxWidth(),&#10;                textAlign = TextAlign.Center&#10;            )&#10;            Text(&#10;                text = description,&#10;                color = Color(0xFFCCCCCC),&#10;                fontSize = 16.sp,&#10;                maxLines = 1,&#10;                modifier = Modifier.fillMaxWidth(),&#10;                textAlign = TextAlign.Center&#10;            )&#10;        }&#10;        if (likeProgress &gt; 0.05f) {&#10;            Icon(&#10;                imageVector = Icons.Default.Favorite,&#10;                contentDescription = &quot;Like&quot;,&#10;                tint = Color.Red.copy(alpha = iconAlpha),&#10;                modifier = Modifier&#10;                    .size((96f * iconScale).dp)&#10;                    .align(Alignment.Center)&#10;            )&#10;        } else if (dislikeProgress &gt; 0.05f) {&#10;            Icon(&#10;                imageVector = Icons.Default.Close,&#10;                contentDescription = &quot;Dislike&quot;,&#10;                tint = Color.White.copy(alpha = iconAlpha),&#10;                modifier = Modifier&#10;                    .size((96f * iconScale).dp)&#10;                    .align(Alignment.Center)&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ActionButtons(&#10;    profiles: List&lt;User&gt;,&#10;    profileIndex: Int,&#10;    handleProfileAction: (Boolean, List&lt;User&gt;, HomeViewModel) -&gt; Unit,&#10;    animateSwipe: suspend (Animatable&lt;Float, *&gt;, Float) -&gt; Unit,&#10;    homeViewModel: HomeViewModel = viewModel()&#10;) {&#10;    val scope = rememberCoroutineScope()&#10;    val offsetX = remember { Animatable(0f) }&#10;&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(vertical = 24.dp),&#10;        horizontalArrangement = Arrangement.spacedBy(25.dp, Alignment.CenterHorizontally),&#10;        verticalAlignment = Alignment.CenterVertically&#10;    ) {&#10;        // Dislike Button&#10;        ActionButton(&#10;            icon = Icons.Default.Close,&#10;            background = Color.White,&#10;            iconTint = Color.Black,&#10;            size = 75.dp,&#10;            shadow = 8.dp&#10;        ) {&#10;            scope.launch {&#10;                animateSwipe(offsetX, -1f)&#10;                handleProfileAction(false, profiles, homeViewModel)&#10;            }&#10;        }&#10;        // Super Like Button&#10;        ActionButton(&#10;            icon = Icons.Default.Favorite,&#10;            background = AppColors.Text_Pink,&#10;            iconTint = Color.White,&#10;            size = 95.dp,&#10;            shadow = 12.dp&#10;        ) {&#10;            scope.launch {&#10;                animateSwipe(offsetX, 1f)&#10;                handleProfileAction(true, profiles, homeViewModel)&#10;            }&#10;        }&#10;        // Like Button&#10;        ActionButton(&#10;            icon = Icons.Default.Star,&#10;            background = Color(0xFF4A154B),&#10;            iconTint = Color.White,&#10;            size = 75.dp,&#10;            shadow = 8.dp&#10;        ) {&#10;            scope.launch {&#10;                animateSwipe(offsetX, 1f)&#10;                handleProfileAction(true, profiles, homeViewModel)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ActionButton(&#10;    icon: ImageVector,&#10;    background: Color,&#10;    iconTint: Color,&#10;    size: Dp,&#10;    shadow: Dp,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    Box(&#10;        modifier = Modifier&#10;            .size(size)&#10;            .shadow(shadow, CircleShape)&#10;            .clip(CircleShape)&#10;            .background(background)&#10;            .clickable { onClick() },&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Icon(&#10;            imageVector = icon,&#10;            contentDescription = null,&#10;            tint = iconTint,&#10;            modifier = Modifier.size(size * 0.5f)&#10;        )&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.dating.ui.mainscreens&#10;&#10;import android.util.Log&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.gestures.detectDragGestures&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.IconButton&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.runtime.saveable.rememberSaveable&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.draw.shadow&#10;import androidx.compose.ui.graphics.Brush&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.input.pointer.pointerInput&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.Dp&#10;import androidx.compose.ui.unit.IntOffset&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.navigation.NavController&#10;import kotlinx.coroutines.launch&#10;import androidx.compose.animation.core.Animatable&#10;import androidx.compose.animation.core.tween&#10;import androidx.compose.material3.CircularProgressIndicator&#10;import com.example.dating.ui.theme.AppColors&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import java.util.Calendar&#10;import androidx.compose.runtime.MutableState&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;import androidx.compose.ui.draw.rotate&#10;import androidx.compose.ui.util.lerp&#10;import androidx.compose.animation.core.Spring&#10;import androidx.compose.animation.core.spring&#10;import androidx.compose.material3.Scaffold&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import com.example.dating.viewmodel.HomeViewModel&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.hilt.navigation.compose.hiltViewModel&#10;import com.example.dating.data.model.Resource&#10;import com.example.dating.data.model.User&#10;import com.example.dating.ui.components.BottomNavigationBar&#10;import androidx.compose.foundation.gestures.detectTapGestures&#10;import com.example.dating.navigation.Screen&#10;import coil.compose.rememberAsyncImagePainter&#10;import com.example.dating.viewmodel.ProfileViewModel&#10;&#10;@Composable&#10;fun HomeScreen(&#10;    navController: NavController,&#10;    homeViewModel: HomeViewModel = hiltViewModel()&#10;) {&#10;    val usersResource by homeViewModel.usersState.collectAsState()&#10;    val profileIndex by homeViewModel.profileIndex.collectAsState()&#10;    Log.d(&quot;HomeScreen&quot;, &quot;usersResource: $usersResource&quot;)&#10;    Log.d(&quot;HomeScreen&quot;, &quot;profileIndex: $profileIndex&quot;)&#10;&#10;&#10;&#10;    // Helper functions&#10;    fun handleProfileAction(isLike: Boolean, profiles: List&lt;User&gt;, homeViewModel: HomeViewModel, navController: NavController) {&#10;        val currentProfile = profiles.getOrNull(profileIndex)&#10;        if (currentProfile != null) {&#10;            if (isLike) {&#10;                val likedUserId = currentProfile.uid&#10;                if (likedUserId != null) {&#10;                    homeViewModel.likeProfile(likedUserId)&#10;                    // Check for match and navigate if found&#10;                    val matchId = homeViewModel.matchFoundUserId.value&#10;                    if (matchId != null) {&#10;                        navController.navigate(&quot;match&quot;)&#10;                    }&#10;                }&#10;            }&#10;            homeViewModel.nextProfile()&#10;        }&#10;    }&#10;    suspend fun animateSwipe(offsetX: Animatable&lt;Float, *&gt;, direction: Float) {&#10;        offsetX.animateTo(direction * 400f, tween(300))&#10;        offsetX.snapTo(0f)&#10;    }&#10;&#10;&#10;&#10;    // Observe matchFoundUserId and navigate if a match is found&#10;    val matchFoundUserId by homeViewModel.matchFoundUserId.collectAsState()&#10;    val matchIdHandled = remember { mutableStateOf(false) }&#10;    LaunchedEffect(matchFoundUserId) {&#10;        Log.d(&quot;HomeScreen&quot;, &quot;LaunchedEffect triggered: matchFoundUserId=$matchFoundUserId, matchIdHandled=${matchIdHandled.value}&quot;)&#10;        if (matchFoundUserId != null &amp;&amp; !matchIdHandled.value) {&#10;            Log.d(&quot;HomeScreen&quot;, &quot;Navigating to match/${matchFoundUserId}&quot;)&#10;            matchIdHandled.value = true&#10;            navController.navigate(&quot;match/${matchFoundUserId}&quot;)&#10;            Log.d(&quot;HomeScreen&quot;, &quot;Resetting matchFoundUserId after navigation&quot;)&#10;            homeViewModel.resetMatchFoundUserId()&#10;        }&#10;    }&#10;&#10;    // Use Box to overlay BottomNavigationBar and keep it fixed at the bottom&#10;    Scaffold(&#10;        bottomBar = {&#10;            BottomNavigationBar(navController, 0)&#10;        }&#10;    ) { paddingValues -&gt;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(paddingValues)&#10;                .background(AppColors.MainBackground)&#10;        ) {&#10;            HomeHeader(navController, homeViewModel)&#10;            when (usersResource) {&#10;                is Resource.Loading -&gt; {&#10;                    Box(&#10;                        modifier = Modifier.fillMaxWidth().height(200.dp),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        CircularProgressIndicator()&#10;                    }&#10;                }&#10;&#10;                is Resource.Failure -&gt; {&#10;                    val error =&#10;                        (usersResource as Resource.Failure).exception?.message ?: &quot;Unknown error&quot;&#10;                    Box(&#10;                        modifier = Modifier.fillMaxWidth().height(200.dp),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        Text(&quot;Error: $error&quot;, color = Color.Red)&#10;                    }&#10;                }&#10;&#10;                is Resource.Success -&gt; {&#10;                    val users = (usersResource as Resource.Success&lt;List&lt;User&gt;&gt;).result&#10;                    val currentProfile = users.getOrNull(profileIndex)&#10;                    val nextProfile = users.getOrNull(profileIndex + 1)&#10;                    if (currentProfile == null &amp;&amp; nextProfile == null) {&#10;                        Box(&#10;                            modifier = Modifier&#10;                                .fillMaxWidth()&#10;                                .height(900.dp),&#10;                            contentAlignment = Alignment.Center&#10;                        ) {&#10;                            Text(&quot;No profiles available&quot;, color = Color.Gray)&#10;                        }&#10;                        return@Column&#10;                    }&#10;                    // Create shared offsetX and offsetY&#10;                    val offsetX = remember { Animatable(0f) }&#10;                    val offsetY = remember { Animatable(0f) }&#10;                    Box(modifier = Modifier.weight(1f)) {&#10;                        ProfileCard(&#10;                            profiles = users,&#10;                            profileIndex = profileIndex,&#10;                            handleProfileAction = { isLike, profiles, homeViewModel -&gt;&#10;                                handleProfileAction(&#10;                                    isLike,&#10;                                    profiles,&#10;                                    homeViewModel,&#10;                                    navController&#10;                                )&#10;                            },&#10;                            animateSwipe = { direction -&gt; animateSwipe(offsetX, direction) },&#10;                            offsetX = offsetX,&#10;                            offsetY = offsetY,&#10;                            navController = navController&#10;                        )&#10;                    }&#10;                    ActionButtons(&#10;                        profiles = users,&#10;                        profileIndex = profileIndex,&#10;                        handleProfileAction = { isLike, profiles, homeViewModel -&gt;&#10;                            handleProfileAction(&#10;                                isLike,&#10;                                profiles,&#10;                                homeViewModel,&#10;                                navController&#10;                            )&#10;                        },&#10;                        animateSwipe = { direction -&gt; animateSwipe(offsetX, direction) },&#10;                        offsetX = offsetX,&#10;                        homeViewModel = homeViewModel&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;}&#10;&#10;@Composable&#10;fun HomeHeader(navController: NavController, homeViewModel: HomeViewModel) {&#10;    val showFilterDialog = remember { mutableStateOf(false) }&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(start = 48.dp, end = 48.dp, top = 40.dp, bottom = 30.dp),&#10;        horizontalArrangement = Arrangement.SpaceBetween,&#10;        verticalAlignment = Alignment.CenterVertically&#10;    ) {&#10;        IconButton(onClick = { navController.navigate(&quot;profile_details&quot;) }) {&#10;            Icon(&#10;                imageVector = Icons.Default.Person,&#10;                contentDescription = &quot;Profile&quot;,&#10;                tint = AppColors.Text_Pink&#10;            )&#10;        }&#10;&#10;        Text(&#10;            text = &quot;Discover&quot;,&#10;            color = Color.Black,&#10;            fontWeight = FontWeight.Bold,&#10;            fontSize = 30.sp&#10;        )&#10;&#10;        IconButton(onClick = { showFilterDialog.value = true }) {&#10;            Icon(&#10;                imageVector = Icons.Default.Settings,&#10;                contentDescription = &quot;Filter&quot;,&#10;                tint = AppColors.Text_Pink&#10;            )&#10;        }&#10;    }&#10;    val userViewModel: ProfileViewModel = hiltViewModel()&#10;    val currentUid = userViewModel.getCurrentUserId().orEmpty()&#10;    Log.d(&quot;HomeHeader&quot;, &quot;Current UID: $currentUid&quot;)&#10;    if (showFilterDialog.value) {&#10;        com.example.dating.ui.components.FilterDialog(&#10;            show = showFilterDialog.value,&#10;            onDismiss = { showFilterDialog.value = false },&#10;            userViewModel = userViewModel,&#10;            currentUid = currentUid,&#10;            onApply = { selectedInterest, location, distance, ageRange, filterChanged -&gt;&#10;                if (filterChanged) {&#10;                    homeViewModel.fetchHome()&#10;                }&#10;                showFilterDialog.value = false&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ProfileCard(&#10;    profiles: List&lt;User&gt;,&#10;    profileIndex: Int,&#10;    handleProfileAction: (Boolean, List&lt;User&gt;, HomeViewModel) -&gt; Unit,&#10;    animateSwipe: suspend (Float) -&gt; Unit,&#10;    offsetX: Animatable&lt;Float, *&gt;,&#10;    offsetY: Animatable&lt;Float, *&gt;,&#10;    homeViewModel: HomeViewModel = viewModel(),&#10;    navController: NavController&#10;) {&#10;    val currentProfile = profiles.getOrNull(profileIndex)&#10;    val nextProfile = profiles.getOrNull(profileIndex + 1)&#10;    val currentUid = currentProfile?.uid&#10;&#10;    if (currentProfile == null &amp;&amp; nextProfile == null) {&#10;        Box(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(900.dp),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Text(&quot;No profiles available&quot;, color = Color.Gray)&#10;        }&#10;        return&#10;    }&#10;&#10;    val scope = rememberCoroutineScope()&#10;    val isDragging = remember { mutableStateOf(false) }&#10;    val likeProgress = (offsetX.value / 200f).coerceIn(0f, 1f)&#10;    val dislikeProgress = (-offsetX.value / 200f).coerceIn(0f, 1f)&#10;    val iconAlpha = maxOf(likeProgress, dislikeProgress)&#10;    val iconScale = 1f + 0.3f * iconAlpha&#10;    val cardRotation = (offsetX.value / 15).coerceIn(-25f, 25f)&#10;    val threshold = 200f&#10;&#10;    Box(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .height(550.dp)&#10;            .padding(horizontal = 30.dp),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        // Render next card first (always present if available)&#10;        if (nextProfile != null) {&#10;            ProfileCardContent(&#10;                profile = nextProfile,&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(550.dp)&#10;                    .clip(RoundedCornerShape(32.dp))&#10;                    .background(Color(0xFF23222B))&#10;                    .graphicsLayer(&#10;                        scaleX = lerp(0.95f, 1f, iconAlpha),&#10;                        scaleY = lerp(0.95f, 1f, iconAlpha),&#10;                        alpha = lerp(0.7f, 1f, iconAlpha)&#10;                    ),&#10;                navController = navController&#10;            )&#10;        }&#10;        // Top card (draggable, always present if available)&#10;        if (currentProfile != null) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(550.dp)&#10;                    .offset { IntOffset(offsetX.value.toInt(), offsetY.value.toInt()) }&#10;                    .rotate(cardRotation)&#10;                    .clip(RoundedCornerShape(32.dp))&#10;                    .background(Color(0xFF23222B))&#10;                    .pointerInput(currentUid) {&#10;                        detectTapGestures(&#10;                            onDoubleTap = {&#10;                                currentUid?.let { uid -&gt;&#10;                                    navController.navigate(Screen.UserProfile.route(uid))&#10;                                }&#10;                            }&#10;                        )&#10;                    }&#10;                    .pointerInput(profileIndex) {&#10;                        detectDragGestures(&#10;                            onDragStart = { isDragging.value = true },&#10;                            onDragEnd = {&#10;                                isDragging.value = false&#10;                                scope.launch {&#10;                                    when {&#10;                                        offsetX.value &gt; threshold -&gt; {&#10;                                            animateSwipe(1f)&#10;                                            offsetY.snapTo(0f)&#10;                                            handleProfileAction(true, profiles, homeViewModel)&#10;                                        }&#10;                                        offsetX.value &lt; -threshold -&gt; {&#10;                                            animateSwipe(-1f)&#10;                                            offsetY.snapTo(0f)&#10;                                            handleProfileAction(false, profiles, homeViewModel)&#10;&#10;                                        }&#10;                                        else -&gt; {&#10;                                            offsetX.animateTo(0f, spring(stiffness = Spring.StiffnessMedium))&#10;                                            offsetY.animateTo(0f, spring(stiffness = Spring.StiffnessMedium))&#10;                                        }&#10;                                    }&#10;                                }&#10;                            },&#10;                            onDrag = { change, dragAmount -&gt;&#10;                                scope.launch {&#10;                                    offsetX.snapTo(offsetX.value + dragAmount.x)&#10;                                    offsetY.snapTo(offsetY.value + dragAmount.y)&#10;                                }&#10;                            }&#10;                        )&#10;                    },&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                ProfileCardContent(&#10;                    profile = currentProfile,&#10;                    modifier = Modifier.fillMaxSize(),&#10;                    navController = navController,&#10;                    likeProgress = likeProgress,&#10;                    dislikeProgress = dislikeProgress,&#10;                    iconAlpha = iconAlpha,&#10;                    iconScale = iconScale&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun ProfileCardContent(&#10;    profile: User?,&#10;    modifier: Modifier = Modifier,&#10;    navController: NavController,&#10;    likeProgress: Float = 0f,&#10;    dislikeProgress: Float = 0f,&#10;    iconAlpha: Float = 0f,&#10;    iconScale: Float = 1f&#10;) {&#10;    if (profile == null) return&#10;    val firstName = profile.firstName ?: &quot;&quot;&#10;    val lastName = profile.lastName ?: &quot;&quot;&#10;    val name = (firstName + &quot; &quot; + lastName).trim().ifEmpty { &quot;Unknown&quot; }&#10;    val birthday = profile.birthday&#10;    val age = birthday?.let {&#10;        try {&#10;            val year = it.split(&quot;/&quot;).getOrNull(2)?.toInt() ?: throw Exception(&quot;Invalid date&quot;)&#10;            val currentYear = Calendar.getInstance().get(Calendar.YEAR)&#10;            (currentYear - year).toString()&#10;        } catch (e: Exception) {&#10;            &quot;?&quot;&#10;        }&#10;    } ?: &quot;?&quot;&#10;    val description = profile.description ?: &quot;No description&quot;&#10;    val distance = profile.distance?.toString() ?: &quot;1 km&quot;&#10;&#10;    Box(modifier = modifier) {&#10;        if (profile.avatarUrl != null &amp;&amp; profile.avatarUrl.isNotBlank()) {&#10;            Image(&#10;                painter = rememberAsyncImagePainter(model = profile.avatarUrl),&#10;                contentDescription = &quot;Profile Image&quot;,&#10;                contentScale = ContentScale.Crop,&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .clip(RoundedCornerShape(32.dp))&#10;            )&#10;        } else {&#10;            Image(&#10;                imageVector = Icons.Default.Person,&#10;                contentDescription = &quot;Profile Image&quot;,&#10;                contentScale = ContentScale.Crop,&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .clip(RoundedCornerShape(32.dp))&#10;            )&#10;        }&#10;        Box(&#10;            modifier = Modifier&#10;                .padding(16.dp)&#10;                .align(Alignment.TopStart)&#10;                .background(Color.White.copy(alpha = 0.85f), RoundedCornerShape(50))&#10;                .padding(horizontal = 16.dp, vertical = 6.dp)&#10;        ) {&#10;            Text(distance, color = Color.Black, fontWeight = FontWeight.Bold, fontSize = 14.sp)&#10;        }&#10;        Box(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(120.dp)&#10;                .align(Alignment.BottomCenter)&#10;                .background(&#10;                    Brush.verticalGradient(&#10;                        colors = listOf(Color.Transparent, Color.Black),&#10;                        startY = 0f,&#10;                        endY = 300f&#10;                    ),&#10;                    shape = RoundedCornerShape(bottomStart = 32.dp, bottomEnd = 32.dp)&#10;                )&#10;        )&#10;        Column(&#10;            modifier = Modifier&#10;                .align(Alignment.BottomCenter)&#10;                .padding(16.dp),&#10;            verticalArrangement = Arrangement.Center,&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&#10;                text = &quot;$name, $age&quot;,&#10;                color = Color.White,&#10;                fontWeight = FontWeight.Bold,&#10;                fontSize = 28.sp,&#10;                maxLines = 1,&#10;                modifier = Modifier.fillMaxWidth(),&#10;                textAlign = TextAlign.Center&#10;            )&#10;            Text(&#10;                text = description,&#10;                color = Color(0xFFCCCCCC),&#10;                fontSize = 16.sp,&#10;                maxLines = 1,&#10;                modifier = Modifier.fillMaxWidth(),&#10;                textAlign = TextAlign.Center&#10;            )&#10;        }&#10;        if (likeProgress &gt; 0.05f) {&#10;            Icon(&#10;                imageVector = Icons.Default.Favorite,&#10;                contentDescription = &quot;Like&quot;,&#10;                tint = Color.Red.copy(alpha = iconAlpha),&#10;                modifier = Modifier&#10;                    .size((96f * iconScale).dp)&#10;                    .align(Alignment.Center)&#10;            )&#10;        } else if (dislikeProgress &gt; 0.05f) {&#10;            Icon(&#10;                imageVector = Icons.Default.Close,&#10;                contentDescription = &quot;Dislike&quot;,&#10;                tint = Color.White.copy(alpha = iconAlpha),&#10;                modifier = Modifier&#10;                    .size((96f * iconScale).dp)&#10;                    .align(Alignment.Center)&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ActionButtons(&#10;    profiles: List&lt;User&gt;,&#10;    profileIndex: Int,&#10;    handleProfileAction: (Boolean, List&lt;User&gt;, HomeViewModel) -&gt; Unit,&#10;    animateSwipe: suspend (Float) -&gt; Unit,&#10;    offsetX: Animatable&lt;Float, *&gt;,&#10;    homeViewModel: HomeViewModel = viewModel()&#10;) {&#10;    val scope = rememberCoroutineScope()&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(vertical = 24.dp),&#10;        horizontalArrangement = Arrangement.spacedBy(25.dp, Alignment.CenterHorizontally),&#10;        verticalAlignment = Alignment.CenterVertically&#10;    ) {&#10;        // Dislike Button&#10;        ActionButton(&#10;            icon = Icons.Default.Close,&#10;            background = Color.White,&#10;            iconTint = Color.Black,&#10;            size = 75.dp,&#10;            shadow = 8.dp&#10;        ) {&#10;            scope.launch {&#10;                animateSwipe(-1f)&#10;                handleProfileAction(false, profiles, homeViewModel)&#10;            }&#10;        }&#10;        // Super Like Button&#10;        ActionButton(&#10;            icon = Icons.Default.Favorite,&#10;            background = AppColors.Text_Pink,&#10;            iconTint = Color.White,&#10;            size = 95.dp,&#10;            shadow = 12.dp&#10;        ) {&#10;            scope.launch {&#10;                animateSwipe(1f)&#10;                handleProfileAction(true, profiles, homeViewModel)&#10;            }&#10;        }&#10;        // Like Button&#10;        ActionButton(&#10;            icon = Icons.Default.Star,&#10;            background = Color(0xFF4A154B),&#10;            iconTint = Color.White,&#10;            size = 75.dp,&#10;            shadow = 8.dp&#10;        ) {&#10;            scope.launch {&#10;                animateSwipe(1f)&#10;                handleProfileAction(true, profiles, homeViewModel)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ActionButton(&#10;    icon: ImageVector,&#10;    background: Color,&#10;    iconTint: Color,&#10;    size: Dp,&#10;    shadow: Dp,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    Box(&#10;        modifier = Modifier&#10;            .size(size)&#10;            .shadow(shadow, CircleShape)&#10;            .clip(CircleShape)&#10;            .background(background)&#10;            .clickable { onClick() },&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Icon(&#10;            imageVector = icon,&#10;            contentDescription = null,&#10;            tint = iconTint,&#10;            modifier = Modifier.size(size * 0.5f)&#10;        )&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/dating/ui/mainscreens/HomeViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/dating/ui/mainscreens/HomeViewModel.kt" />
              <option name="updatedContent" value="package com.example.dating.ui.mainscreens&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.google.firebase.Timestamp&#10;import com.google.firebase.auth.FirebaseAuth&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;class HomeViewModel : ViewModel() {&#10;    private val db = FirebaseFirestore.getInstance()&#10;    private val _addFavoriteState = MutableStateFlow&lt;Result&lt;Unit&gt;?&gt;(null)&#10;    val addFavoriteState: StateFlow&lt;Result&lt;Unit&gt;?&gt; = _addFavoriteState&#10;&#10;    fun addFavorite(likedId: String) {&#10;        val likerId = FirebaseAuth.getInstance().currentUser?.uid ?: return&#10;        val favorite = hashMapOf(&#10;            &quot;likerId&quot; to likerId,&#10;            &quot;likedId&quot; to likedId,&#10;            &quot;timestamp&quot; to Timestamp.now()&#10;        )&#10;        viewModelScope.launch {&#10;            try {&#10;                db.collection(&quot;favorites&quot;).add(favorite)&#10;                _addFavoriteState.value = Result.success(Unit)&#10;            } catch (e: Exception) {&#10;                _addFavoriteState.value = Result.failure(e)&#10;            }&#10;        }&#10;    }&#10;&#10;    fun clearAddFavoriteState() {&#10;        _addFavoriteState.value = null&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/dating/ui/profile/UserProfileScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/dating/ui/profile/UserProfileScreen.kt" />
              <option name="originalContent" value="package com.example.dating.ui.profile&#10;&#10;import android.annotation.SuppressLint&#10;import android.util.Log&#10;import androidx.compose.animation.core.Animatable&#10;import androidx.compose.animation.core.Spring&#10;import androidx.compose.animation.core.spring&#10;import androidx.compose.animation.core.tween&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.gestures.detectDragGestures&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.FlowRow&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.grid.GridCells&#10;import androidx.compose.foundation.lazy.grid.LazyVerticalGrid&#10;import androidx.compose.foundation.lazy.grid.items&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Close&#10;import androidx.compose.material.icons.filled.Favorite&#10;import androidx.compose.material.icons.filled.Star&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.draw.shadow&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import androidx.compose.ui.input.pointer.pointerInput&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.ui.res.painterResource&#10;import androidx.compose.ui.text.SpanStyle&#10;import androidx.compose.ui.text.buildAnnotatedString&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextOverflow&#10;import androidx.compose.ui.text.withStyle&#10;import androidx.compose.ui.unit.Dp&#10;import androidx.compose.ui.unit.IntOffset&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.zIndex&#10;import androidx.hilt.navigation.compose.hiltViewModel&#10;import androidx.navigation.NavController&#10;import coil.compose.AsyncImage&#10;import com.example.dating.R&#10;import com.example.dating.data.model.User&#10;import com.example.dating.navigation.Screen&#10;import com.example.dating.viewmodel.HomeViewModel&#10;import kotlinx.coroutines.CoroutineScope&#10;import kotlinx.coroutines.launch&#10;import java.util.Calendar&#10;import com.example.dating.ui.theme.AppColors&#10;import androidx.compose.foundation.BorderStroke&#10;import com.example.dating.data.model.Resource&#10;&#10;data class Interest(&#10;    val name: String,&#10;    val icon: Int&#10;)&#10;&#10;@SuppressLint(&quot;UnrememberedGetBackStackEntry&quot;)&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun UserProfileScreen(&#10;    navController: NavController,&#10;    userUid: String? = null,&#10;    homeViewModel: HomeViewModel = hiltViewModel()&#10;) {&#10;    val usersResource by homeViewModel.usersState.collectAsState()&#10;    val profileIndex by homeViewModel.profileIndex.collectAsState()&#10;    val matchFoundUserId by homeViewModel.matchFoundUserId.collectAsState()&#10;&#10;    val profiles = usersResource.let { res -&gt;&#10;        when (res) {&#10;            is Resource.Success -&gt; res.result&#10;            else -&gt; emptyList()&#10;        }&#10;    }&#10;    val user = profiles.getOrNull(profileIndex)&#10;    val isLoading = usersResource is Resource.Loading&#10;&#10;    LaunchedEffect(matchFoundUserId) {&#10;        matchFoundUserId?.let { id -&gt;&#10;            navController.navigate(&quot;match/$id&quot;)&#10;            homeViewModel.resetMatchFoundUserId()&#10;        }&#10;    }&#10;&#10;    when {&#10;        isLoading -&gt; Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;            CircularProgressIndicator()&#10;        }&#10;        user != null -&gt; UserProfileContent(&#10;            navController = navController,&#10;            profiles = profiles,&#10;            profileIndex = profileIndex,&#10;            homeViewModel = homeViewModel,&#10;            onSwipeDone = {&#10;            },&#10;            onSeeAll = { images -&gt;&#10;                navController.currentBackStackEntry?.savedStateHandle?.set(&quot;images&quot;, ArrayList(images))&#10;                navController.navigate(Screen.PhotoViewer.route(0))&#10;            },&#10;            onImageClick = { index, images -&gt;&#10;                navController.currentBackStackEntry?.savedStateHandle?.set(&quot;images&quot;, ArrayList(images))&#10;                navController.navigate(Screen.PhotoViewer.route(index))&#10;            }&#10;        )&#10;        else -&gt; Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;            Text(&quot;Cannot load profile&quot;)&#10;        }&#10;    }&#10;}&#10;@OptIn(ExperimentalLayoutApi::class)&#10;@Composable&#10;private fun UserProfileContent(&#10;    navController: NavController,&#10;    profiles: List&lt;User&gt;,&#10;    profileIndex: Int,&#10;    homeViewModel: HomeViewModel,&#10;    onSwipeDone: () -&gt; Unit,&#10;    onSeeAll: (List&lt;String&gt;) -&gt; Unit,&#10;    onImageClick: (Int, List&lt;String&gt;) -&gt; Unit&#10;) {&#10;    val currentProfile = profiles.getOrNull(profileIndex)&#10;    val nextProfile = profiles.getOrNull(profileIndex + 1)&#10;    val images = currentProfile?.imageUrl ?: emptyList()&#10;    val nextImages = nextProfile?.imageUrl ?: emptyList()&#10;&#10;    val scope = rememberCoroutineScope()&#10;    val offsetX = remember { Animatable(0f) }&#10;    val offsetY = remember { Animatable(0f) }&#10;    val threshold = 200f&#10;    val rotation = (offsetX.value / 15).coerceIn(-10f, 10f)&#10;&#10;    fun handleProfileAction(isLike: Boolean) {&#10;        if (isLike) {&#10;            currentProfile?.uid?.let { uid -&gt;&#10;                homeViewModel.likeProfile(uid)&#10;            }&#10;        }&#10;        homeViewModel.nextProfile()&#10;    }&#10;&#10;    suspend fun animateSwipe(direction: Float) {&#10;        offsetX.animateTo(direction * 400f, tween(300))&#10;        offsetX.snapTo(0f)&#10;        offsetY.snapTo(0f)&#10;        onSwipeDone()&#10;    }&#10;&#10;    Box(&#10;        modifier = Modifier.fillMaxSize().background(AppColors.MainBackground),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        // Next profile luôn nằm dưới&#10;        if (nextProfile != null) {&#10;            Box(modifier = Modifier.fillMaxSize()) {&#10;                LazyColumn(&#10;                    modifier = Modifier&#10;                        .fillMaxSize()&#10;                        .graphicsLayer(&#10;                            scaleX = 0.95f,&#10;                            scaleY = 0.95f,&#10;                            alpha = 0.7f,&#10;                            translationY = 32f&#10;                        )&#10;                        .background(Color(0xFF23222B)),&#10;                    horizontalAlignment = Alignment.CenterHorizontally,&#10;                    contentPadding = PaddingValues(bottom = 0.dp)&#10;                ) {&#10;                    item {&#10;                        ProfileHero(&#10;                            profile = nextProfile,&#10;                            navController = navController&#10;                        )&#10;                    }&#10;                    item {&#10;                        ProfileActionsRow(&#10;                            onLike = {},&#10;                            onDislike = {},&#10;                            onSuperLike = {}&#10;                        )&#10;                    }&#10;                    item {&#10;                        ProfileInfoCard(&#10;                            user = nextProfile,&#10;                            images = nextImages,&#10;                            onSeeAll = onSeeAll,&#10;                            onImageClick = onImageClick&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;&#10;        // Current profile luôn nằm trên + draggable&#10;        if (currentProfile != null) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .background(AppColors.MainBackground)&#10;                    .offset { IntOffset(offsetX.value.toInt(), offsetY.value.toInt()) }&#10;                    .graphicsLayer { rotationZ = rotation }&#10;                    .pointerInput(Unit) {&#10;                        detectDragGestures(&#10;                            onDragEnd = {&#10;                                scope.launch {&#10;                                    when {&#10;                                        offsetX.value &gt; threshold -&gt; {&#10;                                            animateSwipe(1f)&#10;                                            handleProfileAction(true)&#10;                                        }&#10;                                        offsetX.value &lt; -threshold -&gt; {&#10;                                            animateSwipe(-1f)&#10;                                            handleProfileAction(false)&#10;                                        }&#10;                                        else -&gt; {&#10;                                            offsetX.animateTo(0f, spring(stiffness = Spring.StiffnessMedium))&#10;                                            offsetY.animateTo(0f, spring(stiffness = Spring.StiffnessMedium))&#10;                                        }&#10;                                    }&#10;                                }&#10;                            }&#10;                        ) { _, drag -&gt;&#10;                            scope.launch {&#10;                                offsetX.snapTo(offsetX.value + drag.x)&#10;                                offsetY.snapTo(offsetY.value + drag.y)&#10;                            }&#10;                        }&#10;                    }&#10;            ) {&#10;                LazyColumn(&#10;                    modifier = Modifier&#10;                        .fillMaxSize(),&#10;                    horizontalAlignment = Alignment.CenterHorizontally,&#10;                    contentPadding = PaddingValues(bottom = 0.dp)&#10;                ) {&#10;                    item {&#10;                        ProfileHero(&#10;                            profile = currentProfile,&#10;                            navController = navController&#10;                        )&#10;                    }&#10;                    item {&#10;                        ProfileActionsRow(&#10;                            onLike = {&#10;                                scope.launch {&#10;                                    animateSwipe(1f)&#10;                                    handleProfileAction(true)&#10;                                }&#10;                            },&#10;                            onDislike = {&#10;                                scope.launch {&#10;                                    animateSwipe(-1f)&#10;                                    handleProfileAction(false)&#10;                                }&#10;                            },&#10;                            onSuperLike = {&#10;                                scope.launch {&#10;                                    animateSwipe(1f)&#10;                                    handleProfileAction(true)&#10;                                }&#10;                            }&#10;                        )&#10;                    }&#10;                    item {&#10;                        ProfileInfoCard(&#10;                            user = currentProfile,&#10;                            images = images,&#10;                            onSeeAll = onSeeAll,&#10;                            onImageClick = onImageClick&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;&#10;@Composable&#10;private fun ActionButton(&#10;    icon: ImageVector,&#10;    background: Color,&#10;    iconTint: Color,&#10;    size: Dp,&#10;    shadow: Dp,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    Box(&#10;        modifier = Modifier&#10;            .size(size)&#10;            .shadow(shadow, CircleShape, clip = false)&#10;            .clip(CircleShape)&#10;            .background(background)&#10;            .clickable { onClick() },&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Icon(&#10;            imageVector = icon,&#10;            contentDescription = null,&#10;            tint = iconTint,&#10;            modifier = Modifier.size(size * 0.5f)&#10;        )&#10;    }&#10;}&#10;&#10;private fun computeAge(birthday: String?): Int? {&#10;    if (birthday.isNullOrBlank()) return null&#10;    return try {&#10;        val year = when {&#10;            birthday.contains(&quot;/&quot;) -&gt; birthday.split(&quot;/&quot;).getOrNull(2)?.toInt()&#10;            birthday.contains(&quot;-&quot;) -&gt; birthday.split(&quot;-&quot;).getOrNull(0)?.toInt()&#10;            else -&gt; null&#10;        } ?: return null&#10;        Calendar.getInstance().get(Calendar.YEAR) - year&#10;    } catch (_: Exception) { null }&#10;}&#10;&#10;@OptIn(ExperimentalLayoutApi::class)&#10;@Composable&#10;private fun ProfileInfoCard(&#10;    user: User,&#10;    images: List&lt;String&gt;,&#10;    onSeeAll: (List&lt;String&gt;) -&gt; Unit,&#10;    onImageClick: (Int, List&lt;String&gt;) -&gt; Unit,&#10;) {&#10;    val firstName = user.firstName.orEmpty()&#10;    val lastName = user.lastName.orEmpty()&#10;    val name = listOf(firstName, lastName).filter { it.isNotBlank() }.joinToString(&quot; &quot;).ifBlank { &quot;Unknown&quot; }&#10;    val birthday = user.birthday&#10;    val ageText = birthday?.let {&#10;        runCatching {&#10;            val y = it.split(&quot;/&quot;).getOrNull(2)?.toInt() ?: return@let &quot;&quot;&#10;            val cy = java.util.Calendar.getInstance().get(java.util.Calendar.YEAR)&#10;            &quot; , ${(cy - y)}&quot;&#10;        }.getOrDefault(&quot;&quot;)&#10;    } ?: &quot;&quot;&#10;    val job = user.job.orEmpty().ifBlank { &quot;Professional model&quot; }&#10;    val location = user.location.orEmpty().ifBlank { &quot;Ho Chi Minh City, Viet Nam&quot; }&#10;    val about = user.description.orEmpty().ifBlank { &quot;My name is $name and I enjoy meeting new people and finding ways to help them have an uplifting experience...&quot; }&#10;&#10;    val allInterests = listOf(&#10;        Interest(&quot;Photography&quot;, R.drawable.ic_interest_photography),&#10;        Interest(&quot;Shopping&quot;, R.drawable.ic_interest_shopping),&#10;        Interest(&quot;Karaoke&quot;, R.drawable.ic_interest_karaoke),&#10;        Interest(&quot;Yoga&quot;, R.drawable.ic_interest_yoga),&#10;        Interest(&quot;Cooking&quot;, R.drawable.ic_interest_cooking),&#10;        Interest(&quot;Tennis&quot;, R.drawable.ic_interest_tennis),&#10;        Interest(&quot;Run&quot;, R.drawable.ic_interest_run),&#10;        Interest(&quot;Swimming&quot;, R.drawable.ic_interest_swimming),&#10;        Interest(&quot;Art&quot;, R.drawable.ic_interest_art),&#10;        Interest(&quot;Traveling&quot;, R.drawable.ic_interest_travelling),&#10;        Interest(&quot;Extreme&quot;, R.drawable.ic_interest_extreme),&#10;        Interest(&quot;Music&quot;, R.drawable.ic_interest_music),&#10;        Interest(&quot;Drink&quot;, R.drawable.ic_interest_drink),&#10;        Interest(&quot;Video games&quot;, R.drawable.ic_interest_game)&#10;    ) // :contentReference[oaicite:1]{index=1}&#10;    val selected = user.interests.toSet()&#10;    Surface(&#10;        shape = RoundedCornerShape(topStart = 28.dp, topEnd = 28.dp),&#10;        color = AppColors.Main_Secondary1,&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .wrapContentHeight()&#10;            .offset(y = (-120).dp)&#10;    ) {&#10;        Column(Modifier.padding(20.dp)) {&#10;            Spacer(Modifier.height(50.dp))&#10;&#10;            // ===== Header: name + age + ic_location&#10;            Row(verticalAlignment = Alignment.CenterVertically) {&#10;                Column(Modifier.weight(1f)) {&#10;                    Text(&#10;                        text = &quot;$name$ageText&quot;,&#10;                        style = MaterialTheme.typography.headlineSmall,&#10;                        fontWeight = FontWeight.Bold,&#10;                        color = MaterialTheme.colorScheme.onSurface&#10;                    )&#10;                    Spacer(Modifier.height(4.dp))&#10;                    Text(&#10;                        text = job,&#10;                        style = MaterialTheme.typography.bodyMedium,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                }&#10;&#10;                // ic_location&#10;                Icon(&#10;                    painter = painterResource(R.drawable.ic_location),&#10;                    contentDescription = &quot;Location&quot;,&#10;                    modifier = Modifier.size(64.dp),&#10;                    tint = Color.Unspecified&#10;                )&#10;            }&#10;&#10;            Spacer(Modifier.height(24.dp))&#10;&#10;            // ===== Location&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Text(&#10;                    text = &quot;Location&quot;,&#10;                    style = MaterialTheme.typography.titleMedium,&#10;                    fontWeight = FontWeight.SemiBold,&#10;                    modifier = Modifier.weight(1f)&#10;                )&#10;&#10;                Surface(&#10;                    color = Color(0xFFF8E6F2),&#10;                    shape = RoundedCornerShape(14.dp),&#10;                    shadowElevation = 0.dp&#10;                ) {&#10;                    Row(&#10;                        verticalAlignment = Alignment.CenterVertically,&#10;                        modifier = Modifier.padding(horizontal = 12.dp, vertical = 8.dp)&#10;                    ) {&#10;                        Icon(&#10;                            painter = painterResource(R.drawable.ic_local),&#10;                            contentDescription = &quot;Location&quot;,&#10;                            tint = Color.Unspecified,&#10;                            modifier = Modifier.size(24.dp)&#10;                        )&#10;                        Text(&#10;                            text = &quot;&quot;,&#10;                            color = AppColors.Text_Pink,&#10;                            style = MaterialTheme.typography.labelLarge&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;            Text(&#10;                text = location,&#10;                style = MaterialTheme.typography.bodyMedium,&#10;                color = MaterialTheme.colorScheme.onSurfaceVariant&#10;            )&#10;&#10;            Spacer(Modifier.height(24.dp))&#10;&#10;&#10;            // ===== About&#10;            Text(&quot;About&quot;, style = MaterialTheme.typography.titleMedium, fontWeight = FontWeight.SemiBold)&#10;            Spacer(Modifier.height(6.dp))&#10;            var expanded by remember { mutableStateOf(false) }&#10;            Text(&#10;                text = about,&#10;                style = MaterialTheme.typography.bodyMedium,&#10;                maxLines = if (expanded) Int.MAX_VALUE else 3,&#10;                overflow = TextOverflow.Ellipsis&#10;            )&#10;            if (!expanded) {&#10;                Text(&#10;                    &quot;Read more&quot;,&#10;                    color = AppColors.Text_Pink,&#10;                    style = MaterialTheme.typography.labelLarge,&#10;                    modifier = Modifier&#10;                        .padding(top = 6.dp)&#10;                        .clickable { expanded = true }&#10;                )&#10;            }&#10;&#10;            // ===== Interests&#10;            Spacer(Modifier.height(24.dp))&#10;            Text(&quot;Interests&quot;, style = MaterialTheme.typography.titleMedium, fontWeight = FontWeight.SemiBold)&#10;            Spacer(Modifier.height(10.dp))&#10;&#10;            Column(verticalArrangement = Arrangement.spacedBy(10.dp)) {&#10;                allInterests.chunked(2).forEach { row -&gt;&#10;                    Row(&#10;                        modifier = Modifier.fillMaxWidth(),&#10;                        horizontalArrangement = Arrangement.spacedBy(10.dp),&#10;                        verticalAlignment = Alignment.CenterVertically&#10;                    ) {&#10;                        row.forEach { interest -&gt;&#10;                            val isSelected = selected.contains(interest.name)&#10;                            Surface(&#10;                                shape = RoundedCornerShape(12.dp),&#10;                                color = if (isSelected) AppColors.Text_Pink.copy(alpha = .12f) else Color.White.copy(alpha = .6f),&#10;                                border = if (isSelected) BorderStroke(2.dp, AppColors.Text_Pink) else BorderStroke(1.dp, Color.LightGray.copy(.35f)),&#10;                                tonalElevation = if (isSelected) 2.dp else 0.dp,&#10;                                modifier = Modifier&#10;                                    .weight(1f)&#10;                                    .height(40.dp)&#10;                            ) {&#10;                                Row(&#10;                                    Modifier.fillMaxSize().padding(horizontal = 12.dp),&#10;                                    horizontalArrangement = Arrangement.Center,&#10;                                    verticalAlignment = Alignment.CenterVertically&#10;                                ) {&#10;                                    Icon(&#10;                                        painter = painterResource(interest.icon),&#10;                                        contentDescription = interest.name,&#10;                                        tint = if (isSelected) AppColors.Text_Pink else Color.Gray,&#10;                                        modifier = Modifier.size(18.dp)&#10;                                    )&#10;                                    Spacer(Modifier.width(8.dp))&#10;                                    Text(&#10;                                        interest.name,&#10;                                        color = if (isSelected) AppColors.Text_Pink else MaterialTheme.colorScheme.onSurface,&#10;                                        fontWeight = if (isSelected) FontWeight.SemiBold else FontWeight.Normal,&#10;                                        style = MaterialTheme.typography.labelLarge&#10;                                    )&#10;                                }&#10;                            }&#10;                        }&#10;                        repeat(2 - row.size) { Spacer(Modifier.weight(1f)) }&#10;                    }&#10;                }&#10;            }&#10;&#10;            // ===== Gallery&#10;            Spacer(Modifier.height(24.dp))&#10;            Row(verticalAlignment = Alignment.CenterVertically, modifier = Modifier.fillMaxWidth()) {&#10;                Text(&quot;Gallery&quot;, style = MaterialTheme.typography.titleMedium, fontWeight = FontWeight.SemiBold, modifier = Modifier.weight(1f))&#10;                Text(&#10;                    &quot;See all&quot;,&#10;                    color = AppColors.Text_Pink,&#10;                    style = MaterialTheme.typography.labelLarge,&#10;                    modifier = Modifier.clickable { if (images.isNotEmpty()) onSeeAll(images) }&#10;                )&#10;            }&#10;            Spacer(Modifier.height(8.dp))&#10;&#10;            if (images.isNotEmpty()) {&#10;                val preview = images.take(6)&#10;                LazyVerticalGrid(&#10;                    columns = GridCells.Fixed(3),&#10;                    horizontalArrangement = Arrangement.spacedBy(8.dp),&#10;                    verticalArrangement = Arrangement.spacedBy(8.dp),&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .height(((preview.size + 2) / 3 * 110).dp)&#10;                ) {&#10;                    items(preview.size) { idx -&gt;&#10;                        AsyncImage(&#10;                            model = preview[idx],&#10;                            contentDescription = null,&#10;                            placeholder = painterResource(R.drawable.ic_avatar),&#10;                            error = painterResource(R.drawable.ic_avatar),&#10;                            contentScale = ContentScale.Crop,&#10;                            modifier = Modifier&#10;                                .aspectRatio(1f)&#10;                                .clip(RoundedCornerShape(12.dp))&#10;                                .clickable { onImageClick(idx, images) }&#10;                        )&#10;                    }&#10;                }&#10;            } else {&#10;                Surface(&#10;                    shape = RoundedCornerShape(12.dp),&#10;                    color = Color.White,&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .height(120.dp)&#10;                ) {&#10;                    Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;                        Text(&quot;No images available&quot;, color = AppColors.Main_Pink)&#10;                    }&#10;                }&#10;            }&#10;&#10;            Spacer(Modifier.height(20.dp))&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ProfileHero(profile: User?, navController: NavController) {&#10;    Box(&#10;        Modifier&#10;            .fillMaxWidth()&#10;            .height(380.dp)&#10;    ) {&#10;        val hero = profile?.avatarUrl ?: profile?.imageUrl?.firstOrNull()&#10;        if (!hero.isNullOrBlank()) {&#10;            AsyncImage(&#10;                model = hero,&#10;                contentDescription = &quot;hero&quot;,&#10;                placeholder = painterResource(R.drawable.ic_avatar),&#10;                error = painterResource(R.drawable.ic_avatar),&#10;                contentScale = ContentScale.Crop,&#10;                modifier = Modifier.fillMaxSize()&#10;            )&#10;        } else {&#10;            Image(&#10;                painter = painterResource(R.drawable.ic_avatar),&#10;                contentDescription = &quot;hero-placeholder&quot;,&#10;                contentScale = ContentScale.Crop,&#10;                modifier = Modifier.fillMaxSize()&#10;            )&#10;        }&#10;        IconButton(&#10;            onClick = { navController.navigateUp() }&#10;        ) {&#10;            Icon(&#10;                painter = painterResource(R.drawable.ic_back_pink),&#10;                contentDescription = &quot;Location&quot;,&#10;                modifier = Modifier.size(64.dp),&#10;                tint = Color.Unspecified&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ProfileActionsRow(&#10;    onLike: () -&gt; Unit,&#10;    onDislike: () -&gt; Unit,&#10;    onSuperLike: () -&gt; Unit&#10;) {&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 52.dp)&#10;            .offset(y = (-64).dp)&#10;            .zIndex(2f),&#10;        horizontalArrangement = Arrangement.SpaceBetween,&#10;        verticalAlignment = Alignment.CenterVertically&#10;    ) {&#10;        ActionButton(&#10;            icon = Icons.Filled.Close,&#10;            background = Color.White,&#10;            iconTint = Color.Black,&#10;            size = 72.dp,&#10;            shadow = 10.dp&#10;        ) { onDislike() }&#10;        ActionButton(&#10;            icon = Icons.Filled.Favorite,&#10;            background = AppColors.Text_Pink,&#10;            iconTint = Color.White,&#10;            size = 96.dp,&#10;            shadow = 16.dp&#10;        ) { onLike() }&#10;        ActionButton(&#10;            icon = Icons.Filled.Star,&#10;            background = Color(0xFF4A154B),&#10;            iconTint = Color.White,&#10;            size = 72.dp,&#10;            shadow = 10.dp&#10;        ) { onSuperLike() }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.dating.ui.profile&#10;&#10;import android.annotation.SuppressLint&#10;import android.util.Log&#10;import androidx.compose.animation.core.Animatable&#10;import androidx.compose.animation.core.Spring&#10;import androidx.compose.animation.core.spring&#10;import androidx.compose.animation.core.tween&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.gestures.detectDragGestures&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.FlowRow&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.grid.GridCells&#10;import androidx.compose.foundation.lazy.grid.LazyVerticalGrid&#10;import androidx.compose.foundation.lazy.grid.items&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Close&#10;import androidx.compose.material.icons.filled.Favorite&#10;import androidx.compose.material.icons.filled.Star&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.draw.shadow&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import androidx.compose.ui.input.pointer.pointerInput&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.ui.res.painterResource&#10;import androidx.compose.ui.text.SpanStyle&#10;import androidx.compose.ui.text.buildAnnotatedString&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextOverflow&#10;import androidx.compose.ui.text.withStyle&#10;import androidx.compose.ui.unit.Dp&#10;import androidx.compose.ui.unit.IntOffset&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.zIndex&#10;import androidx.hilt.navigation.compose.hiltViewModel&#10;import androidx.navigation.NavController&#10;import coil.compose.AsyncImage&#10;import com.example.dating.R&#10;import com.example.dating.data.model.User&#10;import com.example.dating.navigation.Screen&#10;import com.example.dating.viewmodel.HomeViewModel&#10;import kotlinx.coroutines.CoroutineScope&#10;import kotlinx.coroutines.launch&#10;import java.util.Calendar&#10;import com.example.dating.ui.theme.AppColors&#10;import androidx.compose.foundation.BorderStroke&#10;import com.example.dating.data.model.Resource&#10;&#10;data class Interest(&#10;    val name: String,&#10;    val icon: Int&#10;)&#10;&#10;@SuppressLint(&quot;UnrememberedGetBackStackEntry&quot;)&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun UserProfileScreen(&#10;    navController: NavController,&#10;    userUid: String? = null,&#10;    homeViewModel: HomeViewModel = hiltViewModel()&#10;) {&#10;    val usersResource by homeViewModel.usersState.collectAsState()&#10;    val profileIndex by homeViewModel.profileIndex.collectAsState()&#10;    val matchFoundUserId by homeViewModel.matchFoundUserId.collectAsState()&#10;&#10;    val profiles = usersResource.let { res -&gt;&#10;        when (res) {&#10;            is Resource.Success -&gt; res.result&#10;            else -&gt; emptyList()&#10;        }&#10;    }&#10;    val user = profiles.getOrNull(profileIndex)&#10;    val isLoading = usersResource is Resource.Loading&#10;&#10;    LaunchedEffect(matchFoundUserId) {&#10;        matchFoundUserId?.let { id -&gt;&#10;            navController.navigate(&quot;match/$id&quot;)&#10;            homeViewModel.resetMatchFoundUserId()&#10;        }&#10;    }&#10;&#10;    when {&#10;        isLoading -&gt; Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;            CircularProgressIndicator()&#10;        }&#10;        user != null -&gt; UserProfileContent(&#10;            navController = navController,&#10;            profiles = profiles,&#10;            profileIndex = profileIndex,&#10;            homeViewModel = homeViewModel,&#10;            onSwipeDone = {&#10;            },&#10;            onSeeAll = { images -&gt;&#10;                navController.currentBackStackEntry?.savedStateHandle?.set(&quot;images&quot;, ArrayList(images))&#10;                navController.navigate(Screen.PhotoViewer.route(0))&#10;            },&#10;            onImageClick = { index, images -&gt;&#10;                navController.currentBackStackEntry?.savedStateHandle?.set(&quot;images&quot;, ArrayList(images))&#10;                navController.navigate(Screen.PhotoViewer.route(index))&#10;            }&#10;        )&#10;        else -&gt; Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;            Text(&quot;Cannot load profile&quot;)&#10;        }&#10;    }&#10;}&#10;@OptIn(ExperimentalLayoutApi::class)&#10;@Composable&#10;private fun UserProfileContent(&#10;    navController: NavController,&#10;    profiles: List&lt;User&gt;,&#10;    profileIndex: Int,&#10;    homeViewModel: HomeViewModel,&#10;    onSwipeDone: () -&gt; Unit,&#10;    onSeeAll: (List&lt;String&gt;) -&gt; Unit,&#10;    onImageClick: (Int, List&lt;String&gt;) -&gt; Unit&#10;) {&#10;    val currentProfile = profiles.getOrNull(profileIndex)&#10;    val nextProfile = profiles.getOrNull(profileIndex + 1)&#10;    val images = currentProfile?.imageUrl ?: emptyList()&#10;    val nextImages = nextProfile?.imageUrl ?: emptyList()&#10;&#10;    val scope = rememberCoroutineScope()&#10;    val offsetX = remember { Animatable(0f) }&#10;    val offsetY = remember { Animatable(0f) }&#10;    val threshold = 200f&#10;    val rotation = (offsetX.value / 15).coerceIn(-10f, 10f)&#10;&#10;    fun handleProfileAction(isLike: Boolean) {&#10;        if (isLike) {&#10;            currentProfile?.uid?.let { uid -&gt;&#10;                homeViewModel.likeProfile(uid)&#10;            }&#10;        }&#10;        homeViewModel.nextProfile()&#10;    }&#10;&#10;    suspend fun animateSwipe(direction: Float) {&#10;        offsetX.animateTo(direction * 400f, tween(300))&#10;        offsetX.snapTo(0f)&#10;        offsetY.snapTo(0f)&#10;        onSwipeDone()&#10;    }&#10;&#10;    Box(&#10;        modifier = Modifier.fillMaxSize().background(AppColors.MainBackground),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        // Next profile luôn nằm dưới&#10;        if (nextProfile != null) {&#10;            Box(modifier = Modifier.fillMaxSize()) {&#10;                LazyColumn(&#10;                    modifier = Modifier&#10;                        .fillMaxSize()&#10;                        .graphicsLayer(&#10;                            scaleX = 0.95f,&#10;                            scaleY = 0.95f,&#10;                            alpha = 0.7f,&#10;                            translationY = 32f&#10;                        )&#10;                        .background(Color(0xFF23222B)),&#10;                    horizontalAlignment = Alignment.CenterHorizontally,&#10;                    contentPadding = PaddingValues(bottom = 0.dp)&#10;                ) {&#10;                    item {&#10;                        ProfileHero(&#10;                            profile = nextProfile,&#10;                            navController = navController&#10;                        )&#10;                    }&#10;                    item {&#10;                        ProfileActionsRow(&#10;                            onLike = {},&#10;                            onDislike = {},&#10;                            onSuperLike = {}&#10;                        )&#10;                    }&#10;                    item {&#10;                        ProfileInfoCard(&#10;                            user = nextProfile,&#10;                            images = nextImages,&#10;                            onSeeAll = onSeeAll,&#10;                            onImageClick = onImageClick&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;&#10;        // Current profile luôn nằm trên + draggable&#10;        if (currentProfile != null) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .background(AppColors.MainBackground)&#10;                    .offset { IntOffset(offsetX.value.toInt(), offsetY.value.toInt()) }&#10;                    .graphicsLayer { rotationZ = rotation }&#10;                    .pointerInput(Unit) {&#10;                        detectDragGestures(&#10;                            onDragEnd = {&#10;                                scope.launch {&#10;                                    when {&#10;                                        offsetX.value &gt; threshold -&gt; {&#10;                                            animateSwipe(1f)&#10;                                            handleProfileAction(true)&#10;                                        }&#10;                                        offsetX.value &lt; -threshold -&gt; {&#10;                                            animateSwipe(-1f)&#10;                                            handleProfileAction(false)&#10;                                        }&#10;                                        else -&gt; {&#10;                                            offsetX.animateTo(0f, spring(stiffness = Spring.StiffnessMedium))&#10;                                            offsetY.animateTo(0f, spring(stiffness = Spring.StiffnessMedium))&#10;                                        }&#10;                                    }&#10;                                }&#10;                            }&#10;                        ) { _, drag -&gt;&#10;                            scope.launch {&#10;                                offsetX.snapTo(offsetX.value + drag.x)&#10;                                offsetY.snapTo(offsetY.value + drag.y)&#10;                            }&#10;                        }&#10;                    }&#10;            ) {&#10;                LazyColumn(&#10;                    modifier = Modifier&#10;                        .fillMaxSize(),&#10;                    horizontalAlignment = Alignment.CenterHorizontally,&#10;                    contentPadding = PaddingValues(bottom = 0.dp)&#10;                ) {&#10;                    item {&#10;                        ProfileHero(&#10;                            profile = currentProfile,&#10;                            navController = navController&#10;                        )&#10;                    }&#10;                    item {&#10;                        ProfileActionsRow(&#10;                            onLike = {&#10;                                scope.launch {&#10;                                    animateSwipe(1f)&#10;                                    handleProfileAction(true)&#10;                                }&#10;                            },&#10;                            onDislike = {&#10;                                scope.launch {&#10;                                    animateSwipe(-1f)&#10;                                    handleProfileAction(false)&#10;                                }&#10;                            },&#10;                            onSuperLike = {&#10;                                scope.launch {&#10;                                    animateSwipe(1f)&#10;                                    handleProfileAction(true)&#10;                                }&#10;                            }&#10;                        )&#10;                    }&#10;                    item {&#10;                        ProfileInfoCard(&#10;                            user = currentProfile,&#10;                            images = images,&#10;                            onSeeAll = onSeeAll,&#10;                            onImageClick = onImageClick&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;&#10;@Composable&#10;private fun ActionButton(&#10;    icon: ImageVector,&#10;    background: Color,&#10;    iconTint: Color,&#10;    size: Dp,&#10;    shadow: Dp,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    Box(&#10;        modifier = Modifier&#10;            .size(size)&#10;            .shadow(shadow, CircleShape, clip = false)&#10;            .clip(CircleShape)&#10;            .background(background)&#10;            .clickable { onClick() },&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Icon(&#10;            imageVector = icon,&#10;            contentDescription = null,&#10;            tint = iconTint,&#10;            modifier = Modifier.size(size * 0.5f)&#10;        )&#10;    }&#10;}&#10;&#10;private fun computeAge(birthday: String?): Int? {&#10;    if (birthday.isNullOrBlank()) return null&#10;    return try {&#10;        val year = when {&#10;            birthday.contains(&quot;/&quot;) -&gt; birthday.split(&quot;/&quot;).getOrNull(2)?.toInt()&#10;            birthday.contains(&quot;-&quot;) -&gt; birthday.split(&quot;-&quot;).getOrNull(0)?.toInt()&#10;            else -&gt; null&#10;        } ?: return null&#10;        Calendar.getInstance().get(Calendar.YEAR) - year&#10;    } catch (_: Exception) { null }&#10;}&#10;&#10;@OptIn(ExperimentalLayoutApi::class)&#10;@Composable&#10;private fun ProfileInfoCard(&#10;    user: User,&#10;    images: List&lt;String&gt;,&#10;    onSeeAll: (List&lt;String&gt;) -&gt; Unit,&#10;    onImageClick: (Int, List&lt;String&gt;) -&gt; Unit,&#10;) {&#10;    val firstName = user.firstName.orEmpty()&#10;    val lastName = user.lastName.orEmpty()&#10;    val name = listOf(firstName, lastName).filter { it.isNotBlank() }.joinToString(&quot; &quot;).ifBlank { &quot;Unknown&quot; }&#10;    val birthday = user.birthday&#10;    val ageText = birthday?.let {&#10;        runCatching {&#10;            val y = it.split(&quot;/&quot;).getOrNull(2)?.toInt() ?: return@let &quot;&quot;&#10;            val cy = java.util.Calendar.getInstance().get(java.util.Calendar.YEAR)&#10;            &quot; , ${(cy - y)}&quot;&#10;        }.getOrDefault(&quot;&quot;)&#10;    } ?: &quot;&quot;&#10;    val job = user.job.orEmpty().ifBlank { &quot;Professional model&quot; }&#10;    val location = user.location.orEmpty().ifBlank { &quot;Ho Chi Minh City, Viet Nam&quot; }&#10;    val about = user.description.orEmpty().ifBlank { &quot;My name is $name and I enjoy meeting new people and finding ways to help them have an uplifting experience...&quot; }&#10;&#10;    val allInterests = listOf(&#10;        Interest(&quot;Photography&quot;, R.drawable.ic_interest_photography),&#10;        Interest(&quot;Shopping&quot;, R.drawable.ic_interest_shopping),&#10;        Interest(&quot;Karaoke&quot;, R.drawable.ic_interest_karaoke),&#10;        Interest(&quot;Yoga&quot;, R.drawable.ic_interest_yoga),&#10;        Interest(&quot;Cooking&quot;, R.drawable.ic_interest_cooking),&#10;        Interest(&quot;Tennis&quot;, R.drawable.ic_interest_tennis),&#10;        Interest(&quot;Run&quot;, R.drawable.ic_interest_run),&#10;        Interest(&quot;Swimming&quot;, R.drawable.ic_interest_swimming),&#10;        Interest(&quot;Art&quot;, R.drawable.ic_interest_art),&#10;        Interest(&quot;Traveling&quot;, R.drawable.ic_interest_travelling),&#10;        Interest(&quot;Extreme&quot;, R.drawable.ic_interest_extreme),&#10;        Interest(&quot;Music&quot;, R.drawable.ic_interest_music),&#10;        Interest(&quot;Drink&quot;, R.drawable.ic_interest_drink),&#10;        Interest(&quot;Video games&quot;, R.drawable.ic_interest_game)&#10;    ) // :contentReference[oaicite:1]{index=1}&#10;    val selected = user.interests.toSet()&#10;    Surface(&#10;        shape = RoundedCornerShape(topStart = 28.dp, topEnd = 28.dp),&#10;        color = AppColors.Main_Secondary1,&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .wrapContentHeight()&#10;            .offset(y = (-120).dp)&#10;    ) {&#10;        Column(Modifier.padding(20.dp)) {&#10;            Spacer(Modifier.height(50.dp))&#10;&#10;            // ===== Header: name + age + ic_location&#10;            Row(verticalAlignment = Alignment.CenterVertically) {&#10;                Column(Modifier.weight(1f)) {&#10;                    Text(&#10;                        text = &quot;$name$ageText&quot;,&#10;                        style = MaterialTheme.typography.headlineSmall,&#10;                        fontWeight = FontWeight.Bold,&#10;                        color = MaterialTheme.colorScheme.onSurface&#10;                    )&#10;                    Spacer(Modifier.height(4.dp))&#10;                    Text(&#10;                        text = job,&#10;                        style = MaterialTheme.typography.bodyMedium,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                }&#10;&#10;                // ic_location&#10;                Icon(&#10;                    painter = painterResource(R.drawable.ic_location),&#10;                    contentDescription = &quot;Location&quot;,&#10;                    modifier = Modifier.size(64.dp),&#10;                    tint = Color.Unspecified&#10;                )&#10;            }&#10;&#10;            Spacer(Modifier.height(24.dp))&#10;&#10;            // ===== Location&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Text(&#10;                    text = &quot;Location&quot;,&#10;                    style = MaterialTheme.typography.titleMedium,&#10;                    fontWeight = FontWeight.SemiBold,&#10;                    modifier = Modifier.weight(1f)&#10;                )&#10;&#10;                Surface(&#10;                    color = Color(0xFFF8E6F2),&#10;                    shape = RoundedCornerShape(14.dp),&#10;                    shadowElevation = 0.dp&#10;                ) {&#10;                    Row(&#10;                        verticalAlignment = Alignment.CenterVertically,&#10;                        modifier = Modifier.padding(horizontal = 12.dp, vertical = 8.dp)&#10;                    ) {&#10;                        Icon(&#10;                            painter = painterResource(R.drawable.ic_local),&#10;                            contentDescription = &quot;Location&quot;,&#10;                            tint = Color.Unspecified,&#10;                            modifier = Modifier.size(24.dp)&#10;                        )&#10;                        Text(&#10;                            text = &quot;&quot;,&#10;                            color = AppColors.Text_Pink,&#10;                            style = MaterialTheme.typography.labelLarge&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;            Text(&#10;                text = location,&#10;                style = MaterialTheme.typography.bodyMedium,&#10;                color = MaterialTheme.colorScheme.onSurfaceVariant&#10;            )&#10;&#10;            Spacer(Modifier.height(24.dp))&#10;&#10;&#10;            // ===== About&#10;            Text(&quot;About&quot;, style = MaterialTheme.typography.titleMedium, fontWeight = FontWeight.SemiBold)&#10;            Spacer(Modifier.height(6.dp))&#10;            var expanded by remember { mutableStateOf(false) }&#10;            Text(&#10;                text = about,&#10;                style = MaterialTheme.typography.bodyMedium,&#10;                maxLines = if (expanded) Int.MAX_VALUE else 3,&#10;                overflow = TextOverflow.Ellipsis&#10;            )&#10;            if (!expanded) {&#10;                Text(&#10;                    &quot;Read more&quot;,&#10;                    color = AppColors.Text_Pink,&#10;                    style = MaterialTheme.typography.labelLarge,&#10;                    modifier = Modifier&#10;                        .padding(top = 6.dp)&#10;                        .clickable { expanded = true }&#10;                )&#10;            }&#10;&#10;            // ===== Interests&#10;            Spacer(Modifier.height(24.dp))&#10;            Text(&quot;Interests&quot;, style = MaterialTheme.typography.titleMedium, fontWeight = FontWeight.SemiBold)&#10;            Spacer(Modifier.height(10.dp))&#10;&#10;            Column(verticalArrangement = Arrangement.spacedBy(10.dp)) {&#10;                allInterests.chunked(2).forEach { row -&gt;&#10;                    Row(&#10;                        modifier = Modifier.fillMaxWidth(),&#10;                        horizontalArrangement = Arrangement.spacedBy(10.dp),&#10;                        verticalAlignment = Alignment.CenterVertically&#10;                    ) {&#10;                        row.forEach { interest -&gt;&#10;                            val isSelected = selected.contains(interest.name)&#10;                            Surface(&#10;                                shape = RoundedCornerShape(12.dp),&#10;                                color = if (isSelected) AppColors.Text_Pink.copy(alpha = .12f) else Color.White.copy(alpha = .6f),&#10;                                border = if (isSelected) BorderStroke(2.dp, AppColors.Text_Pink) else BorderStroke(1.dp, Color.LightGray.copy(.35f)),&#10;                                tonalElevation = if (isSelected) 2.dp else 0.dp,&#10;                                modifier = Modifier&#10;                                    .weight(1f)&#10;                                    .height(40.dp)&#10;                            ) {&#10;                                Row(&#10;                                    Modifier.fillMaxSize().padding(horizontal = 12.dp),&#10;                                    horizontalArrangement = Arrangement.Center,&#10;                                    verticalAlignment = Alignment.CenterVertically&#10;                                ) {&#10;                                    Icon(&#10;                                        painter = painterResource(interest.icon),&#10;                                        contentDescription = interest.name,&#10;                                        tint = if (isSelected) AppColors.Text_Pink else Color.Gray,&#10;                                        modifier = Modifier.size(18.dp)&#10;                                    )&#10;                                    Spacer(Modifier.width(8.dp))&#10;                                    Text(&#10;                                        interest.name,&#10;                                        color = if (isSelected) AppColors.Text_Pink else MaterialTheme.colorScheme.onSurface,&#10;                                        fontWeight = if (isSelected) FontWeight.SemiBold else FontWeight.Normal,&#10;                                        style = MaterialTheme.typography.labelLarge&#10;                                    )&#10;                                }&#10;                            }&#10;                        }&#10;                        repeat(2 - row.size) { Spacer(Modifier.weight(1f)) }&#10;                    }&#10;                }&#10;            }&#10;&#10;            // ===== Gallery&#10;            Spacer(Modifier.height(24.dp))&#10;            Row(verticalAlignment = Alignment.CenterVertically, modifier = Modifier.fillMaxWidth()) {&#10;                Text(&quot;Gallery&quot;, style = MaterialTheme.typography.titleMedium, fontWeight = FontWeight.SemiBold, modifier = Modifier.weight(1f))&#10;                Text(&#10;                    &quot;See all&quot;,&#10;                    color = AppColors.Text_Pink,&#10;                    style = MaterialTheme.typography.labelLarge,&#10;                    modifier = Modifier.clickable { if (images.isNotEmpty()) onSeeAll(images) }&#10;                )&#10;            }&#10;            Spacer(Modifier.height(8.dp))&#10;&#10;            if (images.isNotEmpty()) {&#10;                val preview = images.take(6)&#10;                LazyVerticalGrid(&#10;                    columns = GridCells.Fixed(3),&#10;                    horizontalArrangement = Arrangement.spacedBy(8.dp),&#10;                    verticalArrangement = Arrangement.spacedBy(8.dp),&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .height(((preview.size + 2) / 3 * 110).dp)&#10;                ) {&#10;                    items(preview.size) { idx -&gt;&#10;                        AsyncImage(&#10;                            model = preview[idx],&#10;                            contentDescription = null,&#10;                            placeholder = painterResource(R.drawable.ic_avatar),&#10;                            error = painterResource(R.drawable.ic_avatar),&#10;                            contentScale = ContentScale.Crop,&#10;                            modifier = Modifier&#10;                                .aspectRatio(1f)&#10;                                .clip(RoundedCornerShape(12.dp))&#10;                                .clickable { onImageClick(idx, images) }&#10;                        )&#10;                    }&#10;                }&#10;            } else {&#10;                Surface(&#10;                    shape = RoundedCornerShape(12.dp),&#10;                    color = Color.White,&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .height(120.dp)&#10;                ) {&#10;                    Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;                        Text(&quot;No images available&quot;, color = AppColors.Main_Pink)&#10;                    }&#10;                }&#10;            }&#10;&#10;            Spacer(Modifier.height(20.dp))&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ProfileHero(profile: User?, navController: NavController) {&#10;    Box(&#10;        Modifier&#10;            .fillMaxWidth()&#10;            .height(380.dp)&#10;    ) {&#10;        val hero = profile?.avatarUrl ?: profile?.imageUrl?.firstOrNull()&#10;        if (!hero.isNullOrBlank()) {&#10;            AsyncImage(&#10;                model = hero,&#10;                contentDescription = &quot;hero&quot;,&#10;                placeholder = painterResource(R.drawable.ic_avatar),&#10;                error = painterResource(R.drawable.ic_avatar),&#10;                contentScale = ContentScale.Crop,&#10;                modifier = Modifier.fillMaxSize()&#10;            )&#10;        } else {&#10;            Image(&#10;                painter = painterResource(R.drawable.ic_avatar),&#10;                contentDescription = &quot;hero-placeholder&quot;,&#10;                contentScale = ContentScale.Crop,&#10;                modifier = Modifier.fillMaxSize()&#10;            )&#10;        }&#10;        IconButton(&#10;            onClick = { navController.navigateUp() }&#10;        ) {&#10;            Icon(&#10;                painter = painterResource(R.drawable.ic_back_pink),&#10;                contentDescription = &quot;Location&quot;,&#10;                modifier = Modifier.size(64.dp),&#10;                tint = Color.Unspecified&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ProfileActionsRow(&#10;    onLike: () -&gt; Unit,&#10;    onDislike: () -&gt; Unit,&#10;    onSuperLike: () -&gt; Unit&#10;) {&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 52.dp)&#10;            .offset(y = (-64).dp)&#10;            .zIndex(2f),&#10;        horizontalArrangement = Arrangement.SpaceBetween,&#10;        verticalAlignment = Alignment.CenterVertically&#10;    ) {&#10;        ActionButton(&#10;            icon = Icons.Filled.Close,&#10;            background = Color.White,&#10;            iconTint = Color.Black,&#10;            size = 72.dp,&#10;            shadow = 10.dp&#10;        ) { onDislike() }&#10;        ActionButton(&#10;            icon = Icons.Filled.Favorite,&#10;            background = AppColors.Text_Pink,&#10;            iconTint = Color.White,&#10;            size = 96.dp,&#10;            shadow = 16.dp&#10;        ) { onLike() }&#10;        ActionButton(&#10;            icon = Icons.Filled.Star,&#10;            background = Color(0xFF4A154B),&#10;            iconTint = Color.White,&#10;            size = 72.dp,&#10;            shadow = 10.dp&#10;        ) { onSuperLike() }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>